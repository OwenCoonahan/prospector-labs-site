<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Developer Reliability Score — Prospector Labs</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: { sans: ['Geist', 'system-ui', 'sans-serif'], mono: ['Geist Mono', 'monospace'] },
      colors: {
        border: 'hsl(var(--border))',
        bg: 'hsl(var(--bg))',
        card: 'hsl(var(--card))',
        muted: 'hsl(var(--muted))',
        'muted-fg': 'hsl(var(--muted-fg))',
        accent: 'hsl(var(--accent))',
      }
    }
  }
}
</script>
<style>
  :root {
    --border: 0 0% 89.8%;
    --bg: 0 0% 100%;
    --card: 0 0% 100%;
    --muted: 0 0% 96.1%;
    --muted-fg: 0 0% 45.1%;
    --accent: 0 0% 96.1%;
  }
  .dark {
    --border: 0 0% 14.9%;
    --bg: 0 0% 3.9%;
    --card: 0 0% 6%;
    --muted: 0 0% 10%;
    --muted-fg: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
  }
  html { background: hsl(var(--bg)); }
  body { font-family: 'Geist', system-ui, sans-serif; background: hsl(var(--bg)); color: hsl(0 0% 90%); }
  .dark body { color: hsl(0 0% 90%); }
  html:not(.dark) body { color: hsl(0 0% 9%); }
  .font-mono { font-family: 'Geist Mono', monospace; }
  .score-excellent { color: #22c55e; }
  .score-good { color: #84cc16; }
  .score-fair { color: #eab308; }
  .score-poor { color: #f97316; }
  .score-bad { color: #ef4444; }
  .card { background: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: 0.75rem; }
  input, select { background: hsl(var(--muted)); border: 1px solid hsl(var(--border)); color: inherit; }
  input:focus, select:focus { outline: none; border-color: hsl(0 0% 40%); }
  .tab-active { border-bottom: 2px solid hsl(0 0% 90%); }
  .dark .tab-active { border-bottom-color: hsl(0 0% 90%); }
  html:not(.dark) .tab-active { border-bottom-color: hsl(0 0% 9%); }
  table th { text-align: left; font-weight: 500; color: hsl(var(--muted-fg)); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
  table td { border-top: 1px solid hsl(var(--border)); }
  .fade-in { animation: fadeIn 0.15s ease-in; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: hsl(var(--border)); border-radius: 3px; }
  .compare-check { width: 16px; height: 16px; accent-color: hsl(0 0% 63.9%); }
</style>
</head>
<body class="min-h-screen">

<div id="app" class="max-w-7xl mx-auto px-6 py-8">
  <!-- Header -->
  <header class="flex items-center justify-between mb-8">
    <div>
      <div class="flex items-center gap-3 mb-1">
        <h1 class="text-lg font-semibold tracking-tight">Developer Reliability Score</h1>
        <span class="text-xs font-mono px-2 py-0.5 rounded" style="background:hsl(var(--muted));color:hsl(var(--muted-fg))">BETA</span>
      </div>
      <p class="text-sm" style="color:hsl(var(--muted-fg))">FICO-like scoring for energy project developers · 5,683 developers · 31,889 projects</p>
    </div>
    <div class="flex items-center gap-4">
      <span class="text-xs font-mono" style="color:hsl(var(--muted-fg))">Prospector Labs</span>
      <button onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-[hsl(var(--muted))] transition-colors" title="Toggle theme">
        <svg id="theme-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="flex gap-6 mb-6 border-b" style="border-color:hsl(var(--border))">
    <button onclick="switchTab('rankings')" id="tab-rankings" class="pb-3 text-sm font-medium tab-active">Rankings</button>
    <button onclick="switchTab('search')" id="tab-search" class="pb-3 text-sm font-medium" style="color:hsl(var(--muted-fg))">Search</button>
    <button onclick="switchTab('compare')" id="tab-compare" class="pb-3 text-sm font-medium" style="color:hsl(var(--muted-fg))">Compare</button>
    <button onclick="switchTab('scorecard')" id="tab-scorecard" class="pb-3 text-sm font-medium" style="color:hsl(var(--muted-fg))">Scorecard</button>
  </nav>

  <!-- Content -->
  <div id="content"></div>
</div>

<script src="data.js"></script>
<script>
// ── State ──
let currentTab = 'rankings';
let selectedDev = null;
let compareList = [];
let sortCol = 'score';
let sortDir = 'desc';
let filterRegion = '';
let filterTech = '';
let filterMinProjects = 3;
let searchQuery = '';
let rankPage = 0;
const PAGE_SIZE = 50;

// ── Helpers ──
const regions = [...new Set(DEVELOPERS.map(d => d.primary_region).filter(Boolean))].sort();
const techs = [...new Set(DEVELOPERS.map(d => d.primary_technology).filter(Boolean))].sort();

function scoreClass(s) {
  if (s >= 700) return 'score-excellent';
  if (s >= 600) return 'score-good';
  if (s >= 500) return 'score-fair';
  if (s >= 400) return 'score-poor';
  return 'score-bad';
}

function gradeColor(g) {
  if (g.startsWith('A')) return '#22c55e';
  if (g.startsWith('B')) return '#84cc16';
  if (g.startsWith('C')) return '#eab308';
  if (g.startsWith('D')) return '#f97316';
  return '#ef4444';
}

function fmt(n, d=0) { return n != null ? n.toLocaleString(undefined, {maximumFractionDigits:d}) : '—'; }
function pct(n) { return n != null ? (n * 100).toFixed(1) + '%' : '—'; }

function filterDevs() {
  return DEVELOPERS.filter(d => {
    if (filterRegion && d.primary_region !== filterRegion) return false;
    if (filterTech && d.primary_technology !== filterTech) return false;
    if (d.total_projects < filterMinProjects) return false;
    if (searchQuery && !d.name.toLowerCase().includes(searchQuery.toLowerCase())) return false;
    return true;
  });
}

function sortDevs(arr) {
  const dir = sortDir === 'desc' ? -1 : 1;
  return [...arr].sort((a, b) => {
    const av = a[sortCol] ?? 0, bv = b[sortCol] ?? 0;
    return av < bv ? dir : av > bv ? -dir : 0;
  });
}

function optionsHtml(items, selected, label) {
  return `<option value="">${label}</option>` + items.map(i => 
    `<option value="${i}" ${i===selected?'selected':''}>${i}</option>`
  ).join('');
}

// ── Filters bar ──
function filtersHtml() {
  return `
    <div class="flex flex-wrap gap-3 mb-5">
      <select onchange="filterRegion=this.value;rankPage=0;render()" class="px-3 py-1.5 rounded-lg text-sm">
        ${optionsHtml(regions, filterRegion, 'All Regions')}
      </select>
      <select onchange="filterTech=this.value;rankPage=0;render()" class="px-3 py-1.5 rounded-lg text-sm">
        ${optionsHtml(techs, filterTech, 'All Technologies')}
      </select>
      <select onchange="filterMinProjects=+this.value;rankPage=0;render()" class="px-3 py-1.5 rounded-lg text-sm">
        <option value="1" ${filterMinProjects===1?'selected':''}>Min 1 project</option>
        <option value="3" ${filterMinProjects===3?'selected':''}>Min 3 projects</option>
        <option value="5" ${filterMinProjects===5?'selected':''}>Min 5 projects</option>
        <option value="10" ${filterMinProjects===10?'selected':''}>Min 10 projects</option>
        <option value="20" ${filterMinProjects===20?'selected':''}>Min 20 projects</option>
      </select>
    </div>`;
}

// ── Sort header ──
function sortHeader(col, label) {
  const arrow = sortCol === col ? (sortDir === 'desc' ? ' ↓' : ' ↑') : '';
  return `<th class="px-3 py-2 cursor-pointer select-none whitespace-nowrap" onclick="toggleSort('${col}')">${label}${arrow}</th>`;
}
function toggleSort(col) {
  if (sortCol === col) sortDir = sortDir === 'desc' ? 'asc' : 'desc';
  else { sortCol = col; sortDir = 'desc'; }
  render();
}

// ── Rankings Tab ──
function renderRankings() {
  const filtered = sortDevs(filterDevs());
  const page = filtered.slice(rankPage * PAGE_SIZE, (rankPage + 1) * PAGE_SIZE);
  const totalPages = Math.ceil(filtered.length / PAGE_SIZE);

  return `
    ${filtersHtml()}
    <div class="card overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr>
              <th class="px-3 py-2 w-8">#</th>
              <th class="px-3 py-2">Developer</th>
              ${sortHeader('score', 'Score')}
              <th class="px-3 py-2">Grade</th>
              ${sortHeader('completion_rate', 'Completion')}
              ${sortHeader('withdrawal_rate', 'Withdrawal')}
              ${sortHeader('total_projects', 'Projects')}
              ${sortHeader('completed_capacity_mw', 'MW Online')}
              <th class="px-3 py-2">Region</th>
              <th class="px-3 py-2">Tech</th>
              <th class="px-3 py-2">Confidence</th>
            </tr>
          </thead>
          <tbody>
            ${page.map((d, i) => `
              <tr class="hover:bg-[hsl(var(--muted))] cursor-pointer transition-colors" onclick="viewDev('${d.name.replace(/'/g,"\\'")}')">
                <td class="px-3 py-2.5 font-mono text-xs" style="color:hsl(var(--muted-fg))">${rankPage * PAGE_SIZE + i + 1}</td>
                <td class="px-3 py-2.5 font-medium">${d.name}</td>
                <td class="px-3 py-2.5 font-mono font-semibold ${scoreClass(d.score)}">${d.score}</td>
                <td class="px-3 py-2.5 font-mono" style="color:${gradeColor(d.grade)}">${d.grade}</td>
                <td class="px-3 py-2.5 font-mono">${pct(d.completion_rate)}</td>
                <td class="px-3 py-2.5 font-mono">${pct(d.withdrawal_rate)}</td>
                <td class="px-3 py-2.5 font-mono">${d.total_projects}</td>
                <td class="px-3 py-2.5 font-mono">${fmt(d.completed_capacity_mw, 0)}</td>
                <td class="px-3 py-2.5 text-xs">${d.primary_region || '—'}</td>
                <td class="px-3 py-2.5 text-xs">${d.primary_technology || '—'}</td>
                <td class="px-3 py-2.5 text-xs">${d.confidence}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
      <div class="flex items-center justify-between px-4 py-3 border-t" style="border-color:hsl(var(--border))">
        <span class="text-xs" style="color:hsl(var(--muted-fg))">${filtered.length} developers</span>
        <div class="flex gap-2">
          <button onclick="rankPage=Math.max(0,rankPage-1);render()" class="px-3 py-1 text-xs rounded-lg" style="background:hsl(var(--muted))" ${rankPage===0?'disabled':''}>← Prev</button>
          <span class="text-xs font-mono py-1" style="color:hsl(var(--muted-fg))">${rankPage+1}/${totalPages}</span>
          <button onclick="rankPage=Math.min(${totalPages-1},rankPage+1);render()" class="px-3 py-1 text-xs rounded-lg" style="background:hsl(var(--muted))" ${rankPage>=totalPages-1?'disabled':''}>Next →</button>
        </div>
      </div>
    </div>`;
}

// ── Search Tab ──
function renderSearch() {
  const results = searchQuery ? sortDevs(filterDevs()).slice(0, 30) : [];
  return `
    <div class="mb-5">
      <input type="text" placeholder="Search developer name..." value="${searchQuery}"
        oninput="searchQuery=this.value;render()"
        class="w-full max-w-lg px-4 py-2.5 rounded-lg text-sm" autofocus>
    </div>
    ${filtersHtml()}
    ${results.length ? `
      <div class="grid gap-3">
        ${results.map(d => `
          <div class="card px-5 py-4 flex items-center justify-between cursor-pointer hover:bg-[hsl(var(--muted))] transition-colors" onclick="viewDev('${d.name.replace(/'/g,"\\'")}')">
            <div>
              <div class="font-medium">${d.name}</div>
              <div class="text-xs mt-1" style="color:hsl(var(--muted-fg))">${d.primary_region || '—'} · ${d.primary_technology || '—'} · ${d.total_projects} projects</div>
            </div>
            <div class="text-right">
              <div class="font-mono text-2xl font-semibold ${scoreClass(d.score)}">${d.score}</div>
              <div class="font-mono text-xs" style="color:${gradeColor(d.grade)}">${d.grade} · ${d.confidence}</div>
            </div>
          </div>
        `).join('')}
      </div>
    ` : searchQuery ? '<p class="text-sm" style="color:hsl(var(--muted-fg))">No results found.</p>' : '<p class="text-sm" style="color:hsl(var(--muted-fg))">Start typing to search developers.</p>'}
  `;
}

// ── Scorecard Tab ──
function renderScorecard() {
  if (!selectedDev) return '<p class="text-sm" style="color:hsl(var(--muted-fg))">Select a developer from Rankings or Search to view their scorecard.</p>';
  const d = DEVELOPERS.find(x => x.name === selectedDev);
  if (!d) return '<p>Developer not found.</p>';

  const dims = [
    { name: 'Completion Rate', weight: 30, score: d.s_completion_rate, raw: pct(d.completion_rate), desc: `${pct(d.completion_rate)} of projects reached COD` },
    { name: 'Withdrawal Rate', weight: 20, score: d.s_withdrawal_rate, raw: pct(d.withdrawal_rate), desc: `${pct(d.withdrawal_rate)} of projects withdrawn (lower is better)` },
    { name: 'Timeline Adherence', weight: 20, score: d.s_timeline_adherence, raw: d.avg_timeline_months ? d.avg_timeline_months.toFixed(0) + ' mo' : 'N/A', desc: d.avg_timeline_months ? `Avg ${d.avg_timeline_months.toFixed(0)} months queue-to-COD` : 'Insufficient data' },
    { name: 'Capacity Delivered', weight: 15, score: d.s_capacity_delivered, raw: fmt(d.completed_capacity_mw, 0) + ' MW', desc: `${fmt(d.completed_capacity_mw, 0)} MW brought online` },
    { name: 'Regional Diversity', weight: 10, score: d.s_regional_diversity, raw: d.regions ? d.regions.split(',').length + ' regions' : '0', desc: `Active in ${d.regions ? d.regions.split(',').length : 0} ISO regions` },
    { name: 'Experience Depth', weight: 5, score: d.s_experience_depth, raw: (d.years_active||0) + ' yrs', desc: `${d.years_active||0} years active, ${d.total_projects} projects` },
  ];

  setTimeout(() => drawRadar('radar-canvas', dims), 50);

  const rList = d.regions ? d.regions.split(',') : [];
  const tList = d.technologies ? d.technologies.split(',') : [];
  const sList = d.states ? d.states.split(',') : [];

  return `
    <button onclick="selectedDev=null;switchTab('rankings')" class="text-xs mb-4 px-3 py-1 rounded-lg" style="background:hsl(var(--muted));color:hsl(var(--muted-fg))">← Back to Rankings</button>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Score hero -->
      <div class="card p-8 flex flex-col items-center justify-center">
        <div class="font-mono text-6xl font-bold ${scoreClass(d.score)}">${d.score}</div>
        <div class="font-mono text-lg mt-1" style="color:${gradeColor(d.grade)}">${d.grade}</div>
        <div class="text-xs mt-2" style="color:hsl(var(--muted-fg))">Confidence: ${d.confidence}</div>
        <div class="text-sm font-medium mt-4">${d.name}</div>
        <div class="text-xs mt-1" style="color:hsl(var(--muted-fg))">${d.primary_region || '—'} · ${d.primary_technology || '—'}</div>
      </div>

      <!-- Radar chart -->
      <div class="card p-6">
        <h3 class="text-xs font-medium mb-4" style="color:hsl(var(--muted-fg))">SCORE DIMENSIONS</h3>
        <canvas id="radar-canvas" width="300" height="300"></canvas>
      </div>

      <!-- Key stats -->
      <div class="card p-6">
        <h3 class="text-xs font-medium mb-4" style="color:hsl(var(--muted-fg))">KEY METRICS</h3>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Total Projects</span><span class="font-mono">${d.total_projects}</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Completed</span><span class="font-mono">${d.completed_projects}</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Active</span><span class="font-mono">${d.active_projects}</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Withdrawn</span><span class="font-mono">${d.withdrawn_projects}</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Total Capacity</span><span class="font-mono">${fmt(d.total_capacity_mw, 0)} MW</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Online Capacity</span><span class="font-mono">${fmt(d.completed_capacity_mw, 0)} MW</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">Years Active</span><span class="font-mono">${d.years_active || '—'}</span></div>
          <div class="flex justify-between"><span style="color:hsl(var(--muted-fg))">First Project</span><span class="font-mono">${d.first_project_year || '—'}</span></div>
        </div>
      </div>
    </div>

    <!-- Score breakdown -->
    <div class="card p-6 mt-6">
      <h3 class="text-xs font-medium mb-4" style="color:hsl(var(--muted-fg))">SCORE BREAKDOWN</h3>
      <div class="space-y-4">
        ${dims.map(dim => `
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span>${dim.name} <span class="font-mono text-xs" style="color:hsl(var(--muted-fg))">(${dim.weight}%)</span></span>
              <span class="font-mono">${dim.score.toFixed(0)}/100 · ${dim.raw}</span>
            </div>
            <div class="w-full h-1.5 rounded-full" style="background:hsl(var(--muted))">
              <div class="h-full rounded-full transition-all" style="width:${dim.score}%;background:${dim.score>=70?'#22c55e':dim.score>=50?'#eab308':'#ef4444'}"></div>
            </div>
            <div class="text-xs mt-0.5" style="color:hsl(var(--muted-fg))">${dim.desc}</div>
          </div>
        `).join('')}
      </div>
    </div>

    <!-- Geography & Tech -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
      <div class="card p-6">
        <h3 class="text-xs font-medium mb-3" style="color:hsl(var(--muted-fg))">REGIONS</h3>
        <div class="flex flex-wrap gap-1.5">${rList.map(r => `<span class="px-2 py-0.5 rounded text-xs font-mono" style="background:hsl(var(--muted))">${r}</span>`).join('')}</div>
      </div>
      <div class="card p-6">
        <h3 class="text-xs font-medium mb-3" style="color:hsl(var(--muted-fg))">TECHNOLOGIES</h3>
        <div class="flex flex-wrap gap-1.5">${tList.map(t => `<span class="px-2 py-0.5 rounded text-xs font-mono" style="background:hsl(var(--muted))">${t}</span>`).join('')}</div>
      </div>
      <div class="card p-6">
        <h3 class="text-xs font-medium mb-3" style="color:hsl(var(--muted-fg))">STATES</h3>
        <div class="flex flex-wrap gap-1.5">${sList.slice(0,15).map(s => `<span class="px-2 py-0.5 rounded text-xs font-mono" style="background:hsl(var(--muted))">${s}</span>`).join('')}${sList.length>15?`<span class="text-xs" style="color:hsl(var(--muted-fg))">+${sList.length-15} more</span>`:''}</div>
      </div>
    </div>
  `;
}

// ── Compare Tab ──
function renderCompare() {
  const searchResults = searchQuery ? DEVELOPERS.filter(d => d.name.toLowerCase().includes(searchQuery.toLowerCase())).slice(0, 10) : [];
  const selected = DEVELOPERS.filter(d => compareList.includes(d.name));

  if (selected.length >= 2) {
    const dims = ['s_completion_rate', 's_withdrawal_rate', 's_timeline_adherence', 's_capacity_delivered', 's_regional_diversity', 's_experience_depth'];
    const dimNames = ['Completion', 'Withdrawal', 'Timeline', 'Capacity', 'Regional', 'Experience'];
    const colors = ['#22c55e', '#3b82f6', '#eab308', '#f97316', '#a855f7'];
    setTimeout(() => drawCompareRadar('compare-radar', selected, dimNames, dims, colors), 50);
  }

  return `
    <div class="mb-5">
      <input type="text" placeholder="Search to add developers (select 2-5)..." value="${searchQuery}"
        oninput="searchQuery=this.value;render()"
        class="w-full max-w-lg px-4 py-2.5 rounded-lg text-sm">
    </div>
    ${searchResults.length && searchQuery ? `
      <div class="card mb-5 max-w-lg overflow-hidden">
        ${searchResults.map(d => `
          <div class="px-4 py-2 flex items-center justify-between hover:bg-[hsl(var(--muted))] cursor-pointer text-sm" onclick="addCompare('${d.name.replace(/'/g,"\\'")}')">
            <span>${d.name}</span>
            <span class="font-mono ${scoreClass(d.score)}">${d.score}</span>
          </div>
        `).join('')}
      </div>
    ` : ''}
    ${compareList.length ? `
      <div class="flex gap-2 mb-5 flex-wrap">
        ${compareList.map((n, i) => `
          <span class="px-3 py-1 rounded-lg text-xs font-medium flex items-center gap-2" style="background:hsl(var(--muted))">
            ${n}
            <button onclick="removeCompare(${i})" class="hover:text-red-400">×</button>
          </span>
        `).join('')}
        <button onclick="compareList=[];render()" class="px-3 py-1 rounded-lg text-xs" style="color:hsl(var(--muted-fg))">Clear all</button>
      </div>
    ` : ''}
    ${selected.length >= 2 ? `
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="card p-6">
          <h3 class="text-xs font-medium mb-4" style="color:hsl(var(--muted-fg))">RADAR COMPARISON</h3>
          <canvas id="compare-radar" width="400" height="400"></canvas>
        </div>
        <div class="card p-6">
          <h3 class="text-xs font-medium mb-4" style="color:hsl(var(--muted-fg))">SCORE COMPARISON</h3>
          <div class="space-y-4">
            ${selected.map((d, i) => `
              <div class="flex items-center gap-4">
                <div class="w-3 h-3 rounded-full" style="background:${['#22c55e','#3b82f6','#eab308','#f97316','#a855f7'][i]}"></div>
                <div class="flex-1">
                  <div class="text-sm font-medium">${d.name}</div>
                  <div class="text-xs" style="color:hsl(var(--muted-fg))">${d.primary_region||'—'} · ${d.primary_technology||'—'}</div>
                </div>
                <div class="font-mono text-2xl font-bold ${scoreClass(d.score)}">${d.score}</div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
      <div class="card overflow-hidden">
        <table class="w-full text-sm">
          <thead><tr>
            <th class="px-4 py-3">Metric</th>
            ${selected.map(d => `<th class="px-4 py-3">${d.name}</th>`).join('')}
          </tr></thead>
          <tbody>
            ${[
              ['Score', d => `<span class="font-mono font-bold ${scoreClass(d.score)}">${d.score}</span>`],
              ['Grade', d => `<span class="font-mono" style="color:${gradeColor(d.grade)}">${d.grade}</span>`],
              ['Completion Rate', d => `<span class="font-mono">${pct(d.completion_rate)}</span>`],
              ['Withdrawal Rate', d => `<span class="font-mono">${pct(d.withdrawal_rate)}</span>`],
              ['Total Projects', d => `<span class="font-mono">${d.total_projects}</span>`],
              ['Completed', d => `<span class="font-mono">${d.completed_projects}</span>`],
              ['Total MW', d => `<span class="font-mono">${fmt(d.total_capacity_mw,0)}</span>`],
              ['MW Online', d => `<span class="font-mono">${fmt(d.completed_capacity_mw,0)}</span>`],
              ['Regions', d => `<span class="font-mono">${d.regions?d.regions.split(',').length:0}</span>`],
              ['Years Active', d => `<span class="font-mono">${d.years_active||'—'}</span>`],
              ['Confidence', d => `<span>${d.confidence}</span>`],
            ].map(([label, fn]) => `
              <tr>
                <td class="px-4 py-2.5" style="color:hsl(var(--muted-fg))">${label}</td>
                ${selected.map(d => `<td class="px-4 py-2.5">${fn(d)}</td>`).join('')}
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    ` : '<p class="text-sm" style="color:hsl(var(--muted-fg))">Select at least 2 developers to compare.</p>'}
  `;
}

function addCompare(name) {
  if (!compareList.includes(name) && compareList.length < 5) {
    compareList.push(name);
    searchQuery = '';
    render();
  }
}
function removeCompare(i) { compareList.splice(i, 1); render(); }

// ── Charts ──
let radarChart = null;
let compareChart = null;

function drawRadar(canvasId, dims) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  if (radarChart) radarChart.destroy();
  const isDark = document.documentElement.classList.contains('dark');
  radarChart = new Chart(canvas, {
    type: 'radar',
    data: {
      labels: dims.map(d => d.name),
      datasets: [{
        data: dims.map(d => d.score),
        backgroundColor: isDark ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)',
        borderColor: isDark ? 'rgba(255,255,255,0.6)' : 'rgba(0,0,0,0.6)',
        pointBackgroundColor: isDark ? 'rgba(255,255,255,0.8)' : 'rgba(0,0,0,0.8)',
        borderWidth: 1.5,
        pointRadius: 3,
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        r: {
          beginAtZero: true, max: 100,
          ticks: { display: false },
          grid: { color: isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)' },
          angleLines: { color: isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)' },
          pointLabels: { color: isDark ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)', font: { size: 11, family: 'Geist' } },
        }
      }
    }
  });
}

function drawCompareRadar(canvasId, devs, dimNames, dimKeys, colors) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  if (compareChart) compareChart.destroy();
  const isDark = document.documentElement.classList.contains('dark');
  compareChart = new Chart(canvas, {
    type: 'radar',
    data: {
      labels: dimNames,
      datasets: devs.map((d, i) => ({
        label: d.name,
        data: dimKeys.map(k => d[k]),
        backgroundColor: colors[i] + '15',
        borderColor: colors[i],
        pointBackgroundColor: colors[i],
        borderWidth: 1.5,
        pointRadius: 3,
      }))
    },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color: isDark?'rgba(255,255,255,0.6)':'rgba(0,0,0,0.6)', font: { size: 11, family: 'Geist' } } } },
      scales: {
        r: {
          beginAtZero: true, max: 100,
          ticks: { display: false },
          grid: { color: isDark?'rgba(255,255,255,0.08)':'rgba(0,0,0,0.08)' },
          angleLines: { color: isDark?'rgba(255,255,255,0.08)':'rgba(0,0,0,0.08)' },
          pointLabels: { color: isDark?'rgba(255,255,255,0.5)':'rgba(0,0,0,0.5)', font: { size: 11, family: 'Geist' } },
        }
      }
    }
  });
}

// ── Navigation ──
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('nav button').forEach(b => {
    b.classList.remove('tab-active');
    b.style.color = 'hsl(var(--muted-fg))';
  });
  const btn = document.getElementById('tab-' + tab);
  btn.classList.add('tab-active');
  btn.style.color = '';
  render();
}

function viewDev(name) {
  selectedDev = name;
  switchTab('scorecard');
}

function toggleTheme() {
  document.documentElement.classList.toggle('dark');
  render();
}

// ── Render ──
function render() {
  const el = document.getElementById('content');
  switch (currentTab) {
    case 'rankings': el.innerHTML = renderRankings(); break;
    case 'search': el.innerHTML = renderSearch(); break;
    case 'scorecard': el.innerHTML = renderScorecard(); break;
    case 'compare': el.innerHTML = renderCompare(); break;
  }
}

render();
</script>
</body>
</html>
