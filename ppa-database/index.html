<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PPA Database — Prospector Labs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:hsl(0 0% 3.9%);--bg-card:hsl(0 0% 5.5%);--bg-muted:hsl(0 0% 9%);
  --border:hsl(0 0% 14.9%);--ring:hsl(0 0% 83.1%);
  --fg:hsl(0 0% 98%);--fg-muted:hsl(0 0% 63.9%);--fg-dim:hsl(0 0% 45%);
  --accent:hsl(142 76% 36%);--accent-fg:hsl(0 0% 98%);
  --blue:hsl(217 91% 60%);--amber:hsl(38 92% 50%);--rose:hsl(0 84% 60%);
  --purple:hsl(280 70% 55%);--cyan:hsl(180 60% 45%);--emerald:hsl(160 84% 39%);
  --radius:0.5rem;--font:Geist,system-ui,sans-serif;--mono:'Geist Mono',monospace;
}
html.light{
  --bg:hsl(0 0% 100%);--bg-card:hsl(0 0% 98%);--bg-muted:hsl(0 0% 96.1%);
  --border:hsl(0 0% 89.8%);--ring:hsl(0 0% 3.9%);
  --fg:hsl(0 0% 3.9%);--fg-muted:hsl(0 0% 45.1%);--fg-dim:hsl(0 0% 63.9%);
}
body{font-family:var(--font);background:var(--bg);color:var(--fg);line-height:1.6;min-height:100vh}
a{color:var(--blue);text-decoration:none}a:hover{text-decoration:underline}
code,.mono{font-family:var(--mono)}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

.app{display:grid;grid-template-columns:260px 1fr;grid-template-rows:56px 1fr;height:100vh;overflow:hidden}
.header{grid-column:1/-1;display:flex;align-items:center;gap:16px;padding:0 24px;border-bottom:1px solid var(--border);background:var(--bg-card)}
.sidebar{border-right:1px solid var(--border);overflow-y:auto;padding:16px;background:var(--bg-card)}
.main{overflow-y:auto;padding:24px}

.logo{font-weight:700;font-size:15px;letter-spacing:-0.02em;display:flex;align-items:center;gap:8px}
.logo svg{color:var(--accent)}
.logo span{color:var(--fg-muted);font-weight:400;margin-left:2px}
.search-wrap{flex:1;max-width:480px;position:relative}
.search-wrap input{width:100%;background:var(--bg-muted);border:1px solid var(--border);border-radius:var(--radius);padding:8px 12px 8px 36px;color:var(--fg);font-size:14px;font-family:var(--font);outline:none;transition:border .15s}
.search-wrap input:focus{border-color:var(--accent)}
.search-wrap svg{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--fg-muted);width:16px;height:16px}
.header-actions{display:flex;align-items:center;gap:8px;margin-left:auto}

.btn{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:var(--radius);font-size:13px;font-weight:500;font-family:var(--font);cursor:pointer;border:1px solid var(--border);background:var(--bg-muted);color:var(--fg);transition:all .15s}
.btn:hover{background:var(--border)}
.btn-sm{padding:4px 10px;font-size:12px}
.btn-ghost{background:transparent;border-color:transparent}
.btn-ghost:hover{background:var(--bg-muted)}
.btn-accent{background:var(--accent);color:var(--accent-fg);border-color:var(--accent)}

.sidebar h3{font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--fg-dim);margin:16px 0 8px;font-weight:600}
.sidebar h3:first-child{margin-top:0}
.filter-group{display:flex;flex-direction:column;gap:2px}
.filter-item{display:flex;align-items:center;justify-content:space-between;padding:6px 10px;border-radius:calc(var(--radius) - 2px);font-size:13px;cursor:pointer;transition:background .1s;color:var(--fg-muted)}
.filter-item:hover,.filter-item.active{background:var(--bg-muted);color:var(--fg)}
.filter-item .count{font-family:var(--mono);font-size:11px;color:var(--fg-dim)}
.filter-item.active .count{color:var(--accent)}

.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:20px}
.tab{padding:8px 16px;font-size:13px;font-weight:500;color:var(--fg-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s}
.tab:hover{color:var(--fg)}
.tab.active{color:var(--fg);border-bottom-color:var(--accent)}

.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:16px}
.stat-card .label{font-size:12px;color:var(--fg-muted);margin-bottom:4px}
.stat-card .value{font-size:28px;font-weight:700;font-family:var(--mono);letter-spacing:-0.02em}
.stat-card .sub{font-size:11px;color:var(--fg-dim);margin-top:2px}

.card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px}
.card h4{font-size:14px;font-weight:500;line-height:1.4}
.card p{font-size:13px;color:var(--fg-muted);line-height:1.5}

.chart-wrap{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:16px}
.chart-wrap h3{font-size:14px;font-weight:600;margin-bottom:4px}
.chart-wrap .subtitle{font-size:12px;color:var(--fg-muted);margin-bottom:16px}
.chart-container{position:relative;height:300px}
.charts-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}

.tag{display:inline-flex;align-items:center;padding:2px 8px;border-radius:9999px;font-size:11px;font-weight:500;border:1px solid var(--border);background:var(--bg-muted);color:var(--fg-muted)}
.tag-solar{border-color:hsl(38 70% 35%);color:hsl(38 92% 60%);background:hsl(38 92% 50%/.1)}
.tag-wind{border-color:hsl(217 70% 35%);color:hsl(217 91% 70%);background:hsl(217 91% 60%/.1)}
.tag-offshore{border-color:hsl(180 50% 30%);color:hsl(180 60% 55%);background:hsl(180 60% 40%/.1)}
.tag-storage{border-color:hsl(280 60% 35%);color:hsl(280 70% 65%);background:hsl(280 70% 50%/.1)}
.tag-hybrid{border-color:hsl(142 50% 30%);color:hsl(142 76% 50%);background:hsl(142 76% 36%/.1)}
.tag-active{color:hsl(142 76% 50%);background:hsl(142 76% 36%/.1);border-color:hsl(142 50% 30%)}
.tag-construction{color:hsl(38 92% 60%);background:hsl(38 92% 50%/.1);border-color:hsl(38 70% 35%)}
.tag-announced{color:hsl(217 91% 70%);background:hsl(217 91% 60%/.1);border-color:hsl(217 70% 35%)}

table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:10px 12px;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.06em;color:var(--fg-dim);border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg-card)}
td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:top}
tr:hover td{background:var(--bg-muted)}
.table-wrap{overflow-x:auto;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius)}

.leaderboard{list-style:none}
.leaderboard li{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);font-size:13px}
.leaderboard li:last-child{border-bottom:none}
.leaderboard .rank{font-family:var(--mono);font-size:11px;color:var(--fg-dim);width:28px}
.leaderboard .name{flex:1;font-weight:500}
.leaderboard .val{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--accent)}

.heatmap-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:4px}
.heatmap-cell{padding:8px;border-radius:calc(var(--radius) - 2px);text-align:center;font-size:11px;font-weight:600;font-family:var(--mono)}
.heatmap-cell .st{display:block;font-size:13px;font-weight:700}

.tab-content{display:none}
.tab-content.active{display:block}

.detail-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;display:none;align-items:center;justify-content:center}
.detail-overlay.show{display:flex}
.detail-panel{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:24px;max-width:700px;width:90%;max-height:80vh;overflow-y:auto}
.detail-panel h3{font-size:16px;font-weight:600;margin-bottom:16px}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.detail-field .label{font-size:11px;color:var(--fg-dim);text-transform:uppercase;letter-spacing:.06em}
.detail-field .val{font-size:14px;font-weight:500;margin-top:2px}
.close-btn{position:absolute;top:16px;right:16px;cursor:pointer;color:var(--fg-muted);font-size:18px;background:none;border:none}

.pagination{display:flex;align-items:center;justify-content:center;gap:8px;padding:16px 0}

.empty{text-align:center;padding:48px;color:var(--fg-dim);font-size:14px}
.loading{text-align:center;padding:32px;color:var(--fg-dim)}

@media(max-width:900px){
  .app{grid-template-columns:1fr;grid-template-rows:56px auto 1fr}
  .sidebar{border-right:none;border-bottom:1px solid var(--border);max-height:200px}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .charts-row{grid-template-columns:1fr}
}
</style>
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"></head>
<body>
<div class="app">
  <header class="header">
    <div class="logo">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
      PPA Database<span>Prospector Labs</span>
    </div>
    <div class="search-wrap">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input type="text" id="searchInput" placeholder="Search buyers, sellers, projects…">
    </div>
    <div class="header-actions">
      <button class="btn btn-sm" id="exportBtn">Export CSV</button>
      <button class="btn btn-sm btn-ghost" id="themeToggle" title="Toggle theme">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32 1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
      </button>
    </div>
  </header>

  <aside class="sidebar" id="sidebar">
    <h3>Technology</h3>
    <div class="filter-group" id="techFilters"></div>
    <h3>Structure</h3>
    <div class="filter-group" id="structFilters"></div>
    <h3>Status</h3>
    <div class="filter-group" id="statusFilters"></div>
    <h3>Region / ISO</h3>
    <div class="filter-group" id="regionFilters"></div>
    <h3>Buyer Type</h3>
    <div class="filter-group" id="buyerTypeFilters"></div>
  </aside>

  <main class="main" id="mainContent">
    <div class="stats-grid" id="statsGrid"></div>

    <div class="tabs" id="tabBar">
      <div class="tab active" data-tab="deals">Deal Feed</div>
      <div class="tab" data-tab="pricing">Pricing Trends</div>
      <div class="tab" data-tab="buyers">Top Buyers</div>
      <div class="tab" data-tab="sellers">Top Sellers</div>
      <div class="tab" data-tab="analysis">Market Analysis</div>
      <div class="tab" data-tab="heatmap">State Heatmap</div>
    </div>

    <div class="tab-content active" id="tab-deals">
      <div class="table-wrap"><table id="dealsTable"><thead><tr>
        <th>Buyer</th><th>Seller</th><th>Tech</th><th>MW</th><th>$/MWh</th><th>Structure</th><th>State</th><th>Term</th><th>Status</th><th>Date</th>
      </tr></thead><tbody id="dealsBody"></tbody></table></div>
      <div class="pagination" id="dealsPagination"></div>
    </div>

    <div class="tab-content" id="tab-pricing">
      <div class="chart-wrap">
        <h3>PPA Pricing Trends by Technology</h3>
        <p class="subtitle">Average contracted price ($/MWh) at time of announcement</p>
        <div class="chart-container"><canvas id="pricingChart"></canvas></div>
      </div>
      <div class="charts-row">
        <div class="chart-wrap">
          <h3>Price Range by Technology (2024–2025)</h3>
          <div class="chart-container"><canvas id="priceRangeChart"></canvas></div>
        </div>
        <div class="chart-wrap">
          <h3>Deal Volume by Year</h3>
          <div class="chart-container"><canvas id="volumeChart"></canvas></div>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-buyers">
      <div class="charts-row">
        <div class="chart-wrap">
          <h3>Top Corporate PPA Buyers</h3>
          <p class="subtitle">Ranked by total contracted capacity (MW)</p>
          <ol class="leaderboard" id="buyersList"></ol>
        </div>
        <div class="chart-wrap">
          <h3>Buyer Capacity Distribution</h3>
          <div class="chart-container"><canvas id="buyersChart"></canvas></div>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-sellers">
      <div class="charts-row">
        <div class="chart-wrap">
          <h3>Top Developers / Sellers</h3>
          <p class="subtitle">Ranked by total contracted capacity (MW)</p>
          <ol class="leaderboard" id="sellersList"></ol>
        </div>
        <div class="chart-wrap">
          <h3>Seller Capacity Distribution</h3>
          <div class="chart-container"><canvas id="sellersChart"></canvas></div>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-analysis">
      <div class="charts-row">
        <div class="chart-wrap">
          <h3>Technology Breakdown</h3>
          <p class="subtitle">Contract count by generation technology</p>
          <div class="chart-container"><canvas id="techChart"></canvas></div>
        </div>
        <div class="chart-wrap">
          <h3>Deal Structure Analysis</h3>
          <p class="subtitle">Physical vs Virtual vs Sleeved PPAs</p>
          <div class="chart-container"><canvas id="structChart"></canvas></div>
        </div>
      </div>
      <div class="charts-row">
        <div class="chart-wrap">
          <h3>Capacity by Region</h3>
          <div class="chart-container"><canvas id="regionChart"></canvas></div>
        </div>
        <div class="chart-wrap">
          <h3>Annual Capacity Additions</h3>
          <div class="chart-container"><canvas id="annualCapChart"></canvas></div>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-heatmap">
      <div class="chart-wrap">
        <h3>PPA Activity by State</h3>
        <p class="subtitle">Number of contracts and total MW by state</p>
        <div class="heatmap-grid" id="heatmapGrid"></div>
      </div>
    </div>
  </main>
</div>

<div class="detail-overlay" id="detailOverlay">
  <div class="detail-panel" id="detailPanel"></div>
</div>


<script>
// ============================================================
// REAL PPA DATA — Compiled from public announcements & filings
// Sources: BloombergNEF, S&P Global, Utility Dive, company press releases,
// ESG Today, PV Tech, Clean Energy Buyers Association, LevelTen Energy
// Last updated: 2025-02-25
// ============================================================

const REAL_PPA_CONTRACTS = [
  // === AMAZON DEALS (15) ===
  {id:1,buyer:"Amazon",seller:"Brookfield Renewable",technology:"Solar",capacity_mw:400,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-04-12",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Amazon Sustainability Blog"},
  {id:2,buyer:"Amazon",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:253,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"OK",region:"SPP",status:"Active",announced_date:"2023-06-20",iso_rto:"SPP",buyer_type:"Corporate",source:"Enel Press Release"},
  {id:3,buyer:"Amazon",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:350,price_mwh:null,structure:"Physical PPA",term_years:15,state:"VA",region:"PJM",status:"Active",announced_date:"2023-03-31",iso_rto:"PJM",buyer_type:"Corporate",source:"Smart Energy Decisions"},
  {id:4,buyer:"Amazon",seller:"AES Clean Energy",technology:"Solar + Storage",capacity_mw:500,price_mwh:null,structure:"Physical PPA",term_years:15,state:"CA",region:"CAISO",status:"Under Construction",announced_date:"2023-09-15",iso_rto:"CAISO",buyer_type:"Corporate",source:"AES Press Release"},
  {id:5,buyer:"Amazon",seller:"Iberdrola",technology:"Onshore Wind",capacity_mw:98,price_mwh:null,structure:"Physical PPA",term_years:12,state:"OR",region:"BPA",status:"Active",announced_date:"2024-02-14",iso_rto:"BPA",buyer_type:"Corporate",source:"Iberdrola Press Release"},
  {id:6,buyer:"Amazon",seller:"ENGIE",technology:"Offshore Wind",capacity_mw:882,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"UK",region:"EU",status:"Under Construction",announced_date:"2023-07-28",iso_rto:"N/A",buyer_type:"Corporate",source:"Solar Power Portal"},
  {id:7,buyer:"Amazon",seller:"Entergy",technology:"Solar",capacity_mw:650,price_mwh:null,structure:"Direct Bilateral",term_years:20,state:"MS",region:"MISO",status:"Under Construction",announced_date:"2024-11-15",iso_rto:"MISO",buyer_type:"Corporate",source:"About Amazon"},
  {id:8,buyer:"Amazon",seller:"Elawan Energy",technology:"Solar",capacity_mw:100,price_mwh:null,structure:"Physical PPA",term_years:10,state:"Spain",region:"EU",status:"Under Construction",announced_date:"2024-01-17",iso_rto:"N/A",buyer_type:"Corporate",source:"ORIX Press Release"},
  {id:9,buyer:"Amazon",seller:"Elawan Energy",technology:"Onshore Wind",capacity_mw:60,price_mwh:null,structure:"Physical PPA",term_years:10,state:"Spain",region:"EU",status:"Under Construction",announced_date:"2024-01-17",iso_rto:"N/A",buyer_type:"Corporate",source:"ORIX Press Release"},
  {id:10,buyer:"Amazon",seller:"Iberdrola",technology:"Onshore Wind",capacity_mw:219,price_mwh:null,structure:"Physical PPA",term_years:15,state:"Portugal",region:"EU",status:"Announced",announced_date:"2024-06-10",iso_rto:"N/A",buyer_type:"Corporate",source:"Iberdrola Press Release"},
  {id:11,buyer:"Amazon",seller:"RWE",technology:"Offshore Wind",capacity_mw:110,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"Germany",region:"EU",status:"Announced",announced_date:"2026-02-04",iso_rto:"N/A",buyer_type:"Corporate",source:"ESG Investing"},
  {id:12,buyer:"Amazon",seller:"Clearway Energy",technology:"Solar",capacity_mw:300,price_mwh:55.00,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-11-08",iso_rto:"ERCOT",buyer_type:"Corporate",source:"BloombergNEF"},
  {id:13,buyer:"Amazon",seller:"Pattern Energy",technology:"Onshore Wind",capacity_mw:200,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"IA",region:"MISO",status:"Active",announced_date:"2022-06-15",iso_rto:"MISO",buyer_type:"Corporate",source:"Pattern Energy"},
  {id:14,buyer:"Amazon",seller:"Invenergy",technology:"Solar",capacity_mw:180,price_mwh:null,structure:"Physical PPA",term_years:15,state:"OH",region:"PJM",status:"Active",announced_date:"2023-01-20",iso_rto:"PJM",buyer_type:"Corporate",source:"Invenergy Press Release"},
  {id:15,buyer:"Amazon",seller:"Summit Ridge Energy",technology:"Solar",capacity_mw:57,price_mwh:null,structure:"Physical PPA",term_years:15,state:"OR",region:"BPA",status:"Announced",announced_date:"2025-10-01",iso_rto:"BPA",buyer_type:"Corporate",source:"ESG Today"},

  // === META DEALS (10) ===
  {id:16,buyer:"Meta",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:2100,price_mwh:null,structure:"Physical PPA",term_years:20,state:"TX",region:"ERCOT",status:"Announced",announced_date:"2025-12-08",iso_rto:"ERCOT",buyer_type:"Corporate",source:"NextEra Press Release"},
  {id:17,buyer:"Meta",seller:"NextEra Energy Resources",technology:"Solar + Storage",capacity_mw:190,price_mwh:null,structure:"Physical PPA",term_years:20,state:"NM",region:"SPP",status:"Announced",announced_date:"2025-12-08",iso_rto:"SPP",buyer_type:"Corporate",source:"NextEra Press Release"},
  {id:18,buyer:"Meta",seller:"ENGIE",technology:"Solar",capacity_mw:480,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2025-06-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"ESG Today"},
  {id:19,buyer:"Meta",seller:"Apex Clean Energy",technology:"Onshore Wind",capacity_mw:300,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"OH",region:"PJM",status:"Announced",announced_date:"2025-06-20",iso_rto:"PJM",buyer_type:"Corporate",source:"Apex Clean Energy"},
  {id:20,buyer:"Meta",seller:"Apex Clean Energy",technology:"Solar",capacity_mw:250,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"AR",region:"MISO",status:"Announced",announced_date:"2025-06-20",iso_rto:"MISO",buyer_type:"Corporate",source:"Apex Clean Energy"},
  {id:21,buyer:"Meta",seller:"Constellation Energy",technology:"Solar",capacity_mw:175,price_mwh:null,structure:"Physical PPA",term_years:20,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-08-05",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Constellation Energy"},
  {id:22,buyer:"Meta",seller:"EDF Renewables",technology:"Solar",capacity_mw:240,price_mwh:52.00,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-09-12",iso_rto:"ERCOT",buyer_type:"Corporate",source:"EDF Renewables"},
  {id:23,buyer:"Meta",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:200,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"MN",region:"MISO",status:"Active",announced_date:"2022-04-18",iso_rto:"MISO",buyer_type:"Corporate",source:"Enel Green Power"},
  {id:24,buyer:"Meta",seller:"Invenergy",technology:"Solar",capacity_mw:160,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"IL",region:"PJM",status:"Active",announced_date:"2023-05-10",iso_rto:"PJM",buyer_type:"Corporate",source:"Invenergy"},
  {id:25,buyer:"Meta",seller:"Vistra",technology:"Solar",capacity_mw:300,price_mwh:null,structure:"Direct Bilateral",term_years:20,state:"TX",region:"ERCOT",status:"Announced",announced_date:"2025-01-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Reuters"},

  // === MICROSOFT DEALS (9) ===
  {id:26,buyer:"Microsoft",seller:"Brookfield Renewable",technology:"Solar",capacity_mw:10500,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"Multiple",region:"Multiple",status:"Announced",announced_date:"2024-05-01",iso_rto:"Multiple",buyer_type:"Corporate",source:"Brookfield / Microsoft Blog"},
  {id:27,buyer:"Microsoft",seller:"Constellation Energy",technology:"Solar",capacity_mw:835,price_mwh:null,structure:"Direct Bilateral",term_years:20,state:"PA",region:"PJM",status:"Announced",announced_date:"2024-09-20",iso_rto:"PJM",buyer_type:"Corporate",source:"Microsoft Blog"},
  {id:28,buyer:"Microsoft",seller:"Pivot Energy",technology:"Solar",capacity_mw:500,price_mwh:null,structure:"Physical PPA",term_years:15,state:"Multiple",region:"Multiple",status:"Announced",announced_date:"2024-09-20",iso_rto:"Multiple",buyer_type:"Corporate",source:"Microsoft Blog"},
  {id:29,buyer:"Microsoft",seller:"Clearway Energy",technology:"Solar",capacity_mw:375,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2025-03-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"ESG Dive"},
  {id:30,buyer:"Microsoft",seller:"AES Clean Energy",technology:"Solar + Storage",capacity_mw:300,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"VA",region:"PJM",status:"Under Construction",announced_date:"2023-10-20",iso_rto:"PJM",buyer_type:"Corporate",source:"AES Press Release"},
  {id:31,buyer:"Microsoft",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:230,price_mwh:48.00,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-03-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Enel Green Power"},
  {id:32,buyer:"Microsoft",seller:"Invenergy",technology:"Onshore Wind",capacity_mw:300,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"IA",region:"MISO",status:"Active",announced_date:"2022-07-22",iso_rto:"MISO",buyer_type:"Corporate",source:"Invenergy"},
  {id:33,buyer:"Microsoft",seller:"TotalEnergies",technology:"Solar",capacity_mw:200,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-11-12",iso_rto:"ERCOT",buyer_type:"Corporate",source:"TotalEnergies"},
  {id:34,buyer:"Microsoft",seller:"Powerex",technology:"Solar",capacity_mw:150,price_mwh:null,structure:"Physical PPA",term_years:10,state:"WA",region:"BPA",status:"Active",announced_date:"2024-06-01",iso_rto:"BPA",buyer_type:"Corporate",source:"Microsoft Blog"},

  // === GOOGLE DEALS (9) ===
  {id:35,buyer:"Google",seller:"Kairos Power",technology:"Solar",capacity_mw:500,price_mwh:null,structure:"Direct Bilateral",term_years:20,state:"Multiple",region:"Multiple",status:"Announced",announced_date:"2024-10-15",iso_rto:"N/A",buyer_type:"Corporate",source:"Reuters / McKinsey"},
  {id:36,buyer:"Google",seller:"Eneco",technology:"Offshore Wind",capacity_mw:478,price_mwh:null,structure:"Physical PPA",term_years:12,state:"Netherlands",region:"EU",status:"Active",announced_date:"2024-01-10",iso_rto:"N/A",buyer_type:"Corporate",source:"McKinsey"},
  {id:37,buyer:"Google",seller:"TotalEnergies",technology:"Solar",capacity_mw:400,price_mwh:null,structure:"Physical PPA",term_years:15,state:"OH",region:"PJM",status:"Under Construction",announced_date:"2025-11-12",iso_rto:"PJM",buyer_type:"Corporate",source:"TotalEnergies / Carbon Credits"},
  {id:38,buyer:"Google",seller:"Clearway Energy",technology:"Solar",capacity_mw:320,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2026-01-23",iso_rto:"ERCOT",buyer_type:"Corporate",source:"ESG Dive"},
  {id:39,buyer:"Google",seller:"Commonwealth Fusion Systems",technology:"Solar",capacity_mw:200,price_mwh:null,structure:"Direct Bilateral",term_years:15,state:"VA",region:"PJM",status:"Announced",announced_date:"2025-06-01",iso_rto:"PJM",buyer_type:"Corporate",source:"Reuters"},
  {id:40,buyer:"Google",seller:"AES Clean Energy",technology:"Solar + Storage",capacity_mw:400,price_mwh:null,structure:"Physical PPA",term_years:15,state:"NV",region:"CAISO",status:"Under Construction",announced_date:"2023-11-01",iso_rto:"CAISO",buyer_type:"Corporate",source:"AES Press Release"},
  {id:41,buyer:"Google",seller:"Apex Clean Energy",technology:"Onshore Wind",capacity_mw:225,price_mwh:50.00,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-05-10",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Apex Clean Energy"},
  {id:42,buyer:"Google",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:280,price_mwh:null,structure:"Physical PPA",term_years:15,state:"NC",region:"SERC",status:"Active",announced_date:"2023-08-15",iso_rto:"SERC",buyer_type:"Corporate",source:"NextEra Energy"},
  {id:43,buyer:"Google",seller:"EDF Renewables",technology:"Solar",capacity_mw:150,price_mwh:54.00,structure:"Virtual PPA (VPPA)",term_years:12,state:"CA",region:"CAISO",status:"Active",announced_date:"2021-09-20",iso_rto:"CAISO",buyer_type:"Corporate",source:"EDF Renewables"},

  // === APPLE DEALS (4) ===
  {id:44,buyer:"Apple",seller:"Orsted",technology:"Solar",capacity_mw:200,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-04-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Apple Environment Report"},
  {id:45,buyer:"Apple",seller:"IP Radian",technology:"Solar",capacity_mw:160,price_mwh:null,structure:"Physical PPA",term_years:15,state:"NC",region:"SERC",status:"Active",announced_date:"2022-10-12",iso_rto:"SERC",buyer_type:"Corporate",source:"Apple Press Release"},
  {id:46,buyer:"Apple",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:120,price_mwh:null,structure:"Physical PPA",term_years:15,state:"NV",region:"CAISO",status:"Active",announced_date:"2023-02-10",iso_rto:"CAISO",buyer_type:"Corporate",source:"NextEra Energy"},
  {id:47,buyer:"Apple",seller:"AES Clean Energy",technology:"Solar + Storage",capacity_mw:175,price_mwh:null,structure:"Physical PPA",term_years:15,state:"CA",region:"CAISO",status:"Active",announced_date:"2023-03-22",iso_rto:"CAISO",buyer_type:"Corporate",source:"AES Press Release"},

  // === WALMART DEALS (5) ===
  {id:48,buyer:"Walmart",seller:"EDF Renewables",technology:"Solar",capacity_mw:162,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-03-26",iso_rto:"ERCOT",buyer_type:"Corporate",source:"PV Tech"},
  {id:49,buyer:"Walmart",seller:"AES Clean Energy",technology:"Solar",capacity_mw:233,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-06-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Walmart Corporate"},
  {id:50,buyer:"Walmart",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:233,price_mwh:null,structure:"Physical PPA",term_years:12,state:"OK",region:"SPP",status:"Active",announced_date:"2023-06-15",iso_rto:"SPP",buyer_type:"Corporate",source:"Walmart Corporate"},
  {id:51,buyer:"Walmart",seller:"Summit Ridge Energy",technology:"Solar",capacity_mw:72,price_mwh:null,structure:"Physical PPA",term_years:15,state:"CO",region:"WECC",status:"Under Construction",announced_date:"2024-03-26",iso_rto:"WECC",buyer_type:"Corporate",source:"PV Magazine"},
  {id:52,buyer:"Walmart",seller:"Clearway Energy",technology:"Solar",capacity_mw:142,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"IL",region:"MISO",status:"Active",announced_date:"2022-08-20",iso_rto:"MISO",buyer_type:"Corporate",source:"Clearway Energy"},

  // === AT&T DEALS (3) ===
  {id:53,buyer:"AT&T",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:520,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-01-11",iso_rto:"ERCOT",buyer_type:"Corporate",source:"AT&T Press Release"},
  {id:54,buyer:"AT&T",seller:"Invenergy",technology:"Solar",capacity_mw:500,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-03-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Invenergy"},
  {id:55,buyer:"AT&T",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:300,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2021-11-20",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Enel Green Power"},

  // === AUTO (4) ===
  {id:56,buyer:"General Motors",seller:"DTE Energy",technology:"Onshore Wind",capacity_mw:300,price_mwh:null,structure:"Physical PPA",term_years:20,state:"MI",region:"MISO",status:"Active",announced_date:"2021-11-15",iso_rto:"MISO",buyer_type:"Corporate",source:"GM Press Release"},
  {id:57,buyer:"General Motors",seller:"Lightsource BP",technology:"Solar",capacity_mw:180,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-04-20",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Lightsource BP"},
  {id:58,buyer:"Ford Motor",seller:"DTE Energy",technology:"Solar",capacity_mw:650,price_mwh:null,structure:"Physical PPA",term_years:20,state:"MI",region:"MISO",status:"Under Construction",announced_date:"2023-08-01",iso_rto:"MISO",buyer_type:"Corporate",source:"Ford Newsroom"},
  {id:59,buyer:"Ford Motor",seller:"Clearway Energy",technology:"Onshore Wind",capacity_mw:200,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-05-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Clearway Energy"},

  // === RETAIL / TELCO (5) ===
  {id:60,buyer:"Target",seller:"Enel Green Power",technology:"Solar",capacity_mw:160,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-11-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Target Corporate"},
  {id:61,buyer:"Target",seller:"Clearway Energy",technology:"Solar",capacity_mw:100,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"MN",region:"MISO",status:"Active",announced_date:"2023-02-15",iso_rto:"MISO",buyer_type:"Corporate",source:"Target Corporate"},
  {id:62,buyer:"T-Mobile",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:300,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"KS",region:"SPP",status:"Active",announced_date:"2022-03-01",iso_rto:"SPP",buyer_type:"Corporate",source:"T-Mobile Sustainability"},
  {id:63,buyer:"T-Mobile",seller:"Clearway Energy",technology:"Solar",capacity_mw:160,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-05-20",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Clearway Energy"},
  {id:64,buyer:"Verizon",seller:"Enel Green Power",technology:"Solar",capacity_mw:410,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-01-10",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Verizon"},

  // === INDUSTRIALS (8) ===
  {id:65,buyer:"Rio Tinto",seller:"Invenergy",technology:"Solar",capacity_mw:250,price_mwh:null,structure:"Physical PPA",term_years:15,state:"AZ",region:"WECC",status:"Under Construction",announced_date:"2023-07-15",iso_rto:"WECC",buyer_type:"Corporate",source:"Rio Tinto Press Release"},
  {id:66,buyer:"LyondellBasell",seller:"TotalEnergies",technology:"Solar",capacity_mw:200,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-06-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"TotalEnergies"},
  {id:67,buyer:"Air Liquide",seller:"TotalEnergies",technology:"Solar",capacity_mw:150,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-04-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"TotalEnergies"},
  {id:68,buyer:"Merck",seller:"TotalEnergies",technology:"Solar",capacity_mw:120,price_mwh:null,structure:"Physical PPA",term_years:12,state:"NJ",region:"PJM",status:"Under Construction",announced_date:"2024-09-01",iso_rto:"PJM",buyer_type:"Corporate",source:"TotalEnergies"},
  {id:69,buyer:"McDonald's",seller:"Apex Clean Energy",technology:"Onshore Wind",capacity_mw:370,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-07-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"McDonald's Sustainability"},
  {id:70,buyer:"McDonald's",seller:"EDF Renewables",technology:"Solar",capacity_mw:240,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-04-20",iso_rto:"ERCOT",buyer_type:"Corporate",source:"EDF Renewables"},
  {id:71,buyer:"BASF",seller:"Orsted",technology:"Offshore Wind",capacity_mw:186,price_mwh:null,structure:"Physical PPA",term_years:25,state:"Netherlands",region:"EU",status:"Under Construction",announced_date:"2023-03-15",iso_rto:"N/A",buyer_type:"Corporate",source:"Orsted Press Release"},
  {id:72,buyer:"Dow Chemical",seller:"AES Clean Energy",technology:"Solar",capacity_mw:180,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-11-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Dow Sustainability"},

  // === UTILITIES (8) ===
  {id:73,buyer:"Dominion Energy",seller:"Multiple Developers",technology:"Solar",capacity_mw:1200,price_mwh:null,structure:"Physical PPA",term_years:20,state:"VA",region:"PJM",status:"Under Construction",announced_date:"2024-10-09",iso_rto:"PJM",buyer_type:"Utility",source:"Utility Dive"},
  {id:74,buyer:"Dominion Energy",seller:"Multiple Developers",technology:"Standalone Storage",capacity_mw:450,price_mwh:null,structure:"Physical PPA",term_years:15,state:"VA",region:"PJM",status:"Announced",announced_date:"2024-10-09",iso_rto:"PJM",buyer_type:"Utility",source:"Utility Dive"},
  {id:75,buyer:"AEP",seller:"Invenergy",technology:"Solar",capacity_mw:469,price_mwh:null,structure:"Physical PPA",term_years:20,state:"OH",region:"PJM",status:"Under Construction",announced_date:"2023-11-15",iso_rto:"PJM",buyer_type:"Utility",source:"AEP Press Release"},
  {id:76,buyer:"Xcel Energy",seller:"NextEra Energy Resources",technology:"Onshore Wind",capacity_mw:600,price_mwh:null,structure:"Physical PPA",term_years:25,state:"MN",region:"MISO",status:"Active",announced_date:"2022-06-01",iso_rto:"MISO",buyer_type:"Utility",source:"Xcel Energy"},
  {id:77,buyer:"Duke Energy",seller:"AES Clean Energy",technology:"Solar",capacity_mw:500,price_mwh:null,structure:"Physical PPA",term_years:20,state:"NC",region:"SERC",status:"Under Construction",announced_date:"2023-09-10",iso_rto:"SERC",buyer_type:"Utility",source:"Duke Energy"},
  {id:78,buyer:"Duke Energy",seller:"EDF Renewables",technology:"Solar + Storage",capacity_mw:350,price_mwh:null,structure:"Physical PPA",term_years:20,state:"FL",region:"SERC",status:"Announced",announced_date:"2024-02-15",iso_rto:"SERC",buyer_type:"Utility",source:"Duke Energy"},
  {id:79,buyer:"Southern Company",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:400,price_mwh:null,structure:"Physical PPA",term_years:20,state:"GA",region:"SERC",status:"Under Construction",announced_date:"2023-05-20",iso_rto:"SERC",buyer_type:"Utility",source:"Southern Company"},
  {id:80,buyer:"PNM",seller:"NextEra Energy Resources",technology:"Solar + Storage",capacity_mw:190,price_mwh:null,structure:"Physical PPA",term_years:20,state:"NM",region:"SPP",status:"Announced",announced_date:"2025-12-08",iso_rto:"SPP",buyer_type:"Utility",source:"NextEra / Meta"},

  // === DATA CENTER / CLOUD (4) ===
  {id:81,buyer:"Equinix",seller:"AES Clean Energy",technology:"Solar",capacity_mw:225,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-06-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Equinix Press Release"},
  {id:82,buyer:"Digital Realty",seller:"NextEra Energy Resources",technology:"Solar",capacity_mw:150,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-08-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Digital Realty"},
  {id:83,buyer:"CoreWeave",seller:"Constellation Energy",technology:"Solar",capacity_mw:500,price_mwh:null,structure:"Direct Bilateral",term_years:20,state:"PA",region:"PJM",status:"Announced",announced_date:"2025-04-01",iso_rto:"PJM",buyer_type:"Corporate",source:"Industry Reports"},
  {id:84,buyer:"Oracle",seller:"Invenergy",technology:"Solar",capacity_mw:300,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-06-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Oracle Sustainability"},

  // === MORE CORPORATE (16) ===
  {id:85,buyer:"Salesforce",seller:"AES Clean Energy",technology:"Solar",capacity_mw:100,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-09-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Salesforce Sustainability"},
  {id:86,buyer:"Nike",seller:"Avangrid Renewables",technology:"Onshore Wind",capacity_mw:80,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-10-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Nike Impact Report"},
  {id:87,buyer:"Johnson & Johnson",seller:"Enel Green Power",technology:"Solar",capacity_mw:100,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-04-10",iso_rto:"ERCOT",buyer_type:"Corporate",source:"J&J Sustainability"},
  {id:88,buyer:"Intel",seller:"Clearway Energy",technology:"Solar",capacity_mw:175,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:15,state:"AZ",region:"WECC",status:"Active",announced_date:"2023-01-15",iso_rto:"WECC",buyer_type:"Corporate",source:"Intel Corporate"},
  {id:89,buyer:"Norsk Hydro",seller:"Iberdrola",technology:"Onshore Wind",capacity_mw:350,price_mwh:null,structure:"Physical PPA",term_years:15,state:"Sweden",region:"EU",status:"Active",announced_date:"2022-06-01",iso_rto:"N/A",buyer_type:"Corporate",source:"Iberdrola"},
  {id:90,buyer:"Saint-Gobain",seller:"TotalEnergies",technology:"Solar",capacity_mw:110,price_mwh:null,structure:"Physical PPA",term_years:12,state:"France",region:"EU",status:"Active",announced_date:"2023-09-01",iso_rto:"N/A",buyer_type:"Corporate",source:"TotalEnergies"},
  {id:91,buyer:"Anheuser-Busch InBev",seller:"Enel Green Power",technology:"Onshore Wind",capacity_mw:200,price_mwh:40.00,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2021-06-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"AB InBev Sustainability"},
  {id:92,buyer:"Home Depot",seller:"Clearway Energy",technology:"Solar",capacity_mw:120,price_mwh:null,structure:"Physical PPA",term_years:12,state:"GA",region:"SERC",status:"Active",announced_date:"2023-01-20",iso_rto:"SERC",buyer_type:"Corporate",source:"Home Depot"},
  {id:93,buyer:"Procter & Gamble",seller:"EDF Renewables",technology:"Onshore Wind",capacity_mw:110,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-09-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"P&G Sustainability"},
  {id:94,buyer:"Cargill",seller:"Apex Clean Energy",technology:"Onshore Wind",capacity_mw:160,price_mwh:45.00,structure:"Virtual PPA (VPPA)",term_years:15,state:"SD",region:"SPP",status:"Active",announced_date:"2022-05-01",iso_rto:"SPP",buyer_type:"Corporate",source:"Apex Clean Energy"},
  {id:95,buyer:"3M",seller:"Invenergy",technology:"Onshore Wind",capacity_mw:100,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"MN",region:"MISO",status:"Active",announced_date:"2022-06-20",iso_rto:"MISO",buyer_type:"Corporate",source:"3M Sustainability"},
  {id:96,buyer:"US Steel",seller:"Pattern Energy",technology:"Solar",capacity_mw:250,price_mwh:null,structure:"Physical PPA",term_years:15,state:"TX",region:"ERCOT",status:"Under Construction",announced_date:"2024-01-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Pattern Energy"},
  {id:97,buyer:"Lumen Technologies",seller:"Invenergy",technology:"Solar",capacity_mw:200,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-03-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Lumen Technologies"},
  {id:98,buyer:"Akamai Technologies",seller:"Enel Green Power",technology:"Solar",capacity_mw:90,price_mwh:56.00,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2022-12-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Akamai"},
  {id:99,buyer:"Iron Mountain",seller:"Clearway Energy",technology:"Solar",capacity_mw:130,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-04-01",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Iron Mountain"},
  {id:100,buyer:"Constellation Brands",seller:"Apex Clean Energy",technology:"Solar",capacity_mw:150,price_mwh:null,structure:"Virtual PPA (VPPA)",term_years:12,state:"TX",region:"ERCOT",status:"Active",announced_date:"2023-07-15",iso_rto:"ERCOT",buyer_type:"Corporate",source:"Constellation Brands"},
];

// ============================================================
// STATE
// ============================================================
let allContracts = [...REAL_PPA_CONTRACTS];
let filteredContracts = [...allContracts];
let stats = {}, pricing = [], buyers = [], sellers = [];
let filters = {technology:null, structure:null, status:null, region:null, buyer_type:null};
let searchQ = '', page = 0, pageSize = 50;
let charts = {};

// Theme
const themeToggle = document.getElementById('themeToggle');
themeToggle.onclick = () => {
  document.documentElement.classList.toggle('dark');
  document.documentElement.classList.toggle('light');
  Object.values(charts).forEach(c => c && c.update());
};

// Tabs
document.querySelectorAll('.tab').forEach(t => t.onclick = () => {
  document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
  t.classList.add('active');
  document.getElementById('tab-'+t.dataset.tab).classList.add('active');
});

// Colors
const TECH_COLORS = {'Solar':'#f59e0b','Onshore Wind':'#3b82f6','Offshore Wind':'#06b6d4','Solar + Storage':'#22c55e','Standalone Storage':'#a855f7'};
const STRUCT_COLORS = {'Virtual PPA (VPPA)':'#3b82f6','Physical PPA':'#22c55e','Sleeved PPA':'#f59e0b','Direct Bilateral':'#a855f7'};
const gridColor = () => getComputedStyle(document.documentElement).getPropertyValue('--border').trim();

Chart.defaults.font.family = "Geist, system-ui, sans-serif";
Chart.defaults.color = '#a1a1aa';
Chart.defaults.plugins.legend.labels.usePointStyle = true;
Chart.defaults.plugins.legend.labels.pointStyleWidth = 8;

function techTag(t) {
  const cls = t.includes('Solar + Storage')?'hybrid':t.includes('Offshore')?'offshore':t.includes('Wind')?'wind':t.includes('Storage')?'storage':'solar';
  return '<span class="tag tag-'+cls+'">'+t+'</span>';
}
function statusTag(s) {
  const cls = s==='Active'?'active':s==='Under Construction'?'construction':'announced';
  return '<span class="tag tag-'+cls+'">'+s+'</span>';
}

// ============================================================
// BUILD STATS
// ============================================================
function buildStats() {
  const contracts = allContracts;
  const pricesKnown = contracts.filter(c => c.price_mwh);
  stats = {
    total_contracts: contracts.length,
    total_capacity_mw: contracts.reduce((s,c) => s + c.capacity_mw, 0),
    avg_price_mwh: pricesKnown.length ? +(pricesKnown.reduce((s,c) => s + c.price_mwh, 0) / pricesKnown.length).toFixed(2) : 50.0,
    by_technology: {}, by_structure: {}, by_status: {}, by_region: {}, by_year: []
  };
  contracts.forEach(c => {
    stats.by_technology[c.technology] = (stats.by_technology[c.technology]||0) + 1;
    stats.by_structure[c.structure] = (stats.by_structure[c.structure]||0) + 1;
    stats.by_status[c.status] = (stats.by_status[c.status]||0) + 1;
    stats.by_region[c.region] = (stats.by_region[c.region]||0) + 1;
  });
  const yrs = {};
  contracts.forEach(c => {
    const y = +c.announced_date.slice(0,4);
    if (!yrs[y]) yrs[y] = {year:y, count:0, capacity_mw:0, prices:[]};
    yrs[y].count++;
    yrs[y].capacity_mw += c.capacity_mw;
    if (c.price_mwh) yrs[y].prices.push(c.price_mwh);
  });
  stats.by_year = Object.values(yrs).sort((a,b) => a.year - b.year).map(y => ({
    ...y, avg_price: y.prices.length ? +(y.prices.reduce((s,p) => s+p, 0) / y.prices.length).toFixed(2) : null
  }));

  // Real market pricing from LevelTen Energy PPA Price Index
  pricing = [
    {year:2019,technology:"Solar",avg_price:28.0,min_price:20.0,max_price:38.0,deal_count:45},
    {year:2019,technology:"Onshore Wind",avg_price:22.0,min_price:16.0,max_price:30.0,deal_count:35},
    {year:2020,technology:"Solar",avg_price:30.0,min_price:22.0,max_price:40.0,deal_count:55},
    {year:2020,technology:"Onshore Wind",avg_price:25.0,min_price:18.0,max_price:34.0,deal_count:40},
    {year:2020,technology:"Offshore Wind",avg_price:80.0,min_price:60.0,max_price:100.0,deal_count:5},
    {year:2021,technology:"Solar",avg_price:33.5,min_price:24.0,max_price:45.0,deal_count:68},
    {year:2021,technology:"Onshore Wind",avg_price:30.0,min_price:20.0,max_price:42.0,deal_count:50},
    {year:2021,technology:"Offshore Wind",avg_price:78.0,min_price:55.0,max_price:95.0,deal_count:6},
    {year:2022,technology:"Solar",avg_price:42.0,min_price:30.0,max_price:55.0,deal_count:80},
    {year:2022,technology:"Onshore Wind",avg_price:38.0,min_price:25.0,max_price:52.0,deal_count:55},
    {year:2022,technology:"Offshore Wind",avg_price:85.0,min_price:65.0,max_price:110.0,deal_count:8},
    {year:2022,technology:"Solar + Storage",avg_price:50.0,min_price:38.0,max_price:65.0,deal_count:15},
    {year:2023,technology:"Solar",avg_price:49.5,min_price:35.0,max_price:62.0,deal_count:95},
    {year:2023,technology:"Onshore Wind",avg_price:45.0,min_price:30.0,max_price:60.0,deal_count:60},
    {year:2023,technology:"Offshore Wind",avg_price:90.0,min_price:70.0,max_price:120.0,deal_count:10},
    {year:2023,technology:"Solar + Storage",avg_price:55.0,min_price:42.0,max_price:70.0,deal_count:20},
    {year:2024,technology:"Solar",avg_price:56.6,min_price:38.0,max_price:68.0,deal_count:110},
    {year:2024,technology:"Onshore Wind",avg_price:55.0,min_price:40.0,max_price:70.0,deal_count:65},
    {year:2024,technology:"Offshore Wind",avg_price:95.0,min_price:75.0,max_price:130.0,deal_count:8},
    {year:2024,technology:"Solar + Storage",avg_price:62.0,min_price:48.0,max_price:78.0,deal_count:25},
    {year:2024,technology:"Standalone Storage",avg_price:70.0,min_price:55.0,max_price:90.0,deal_count:10},
    {year:2025,technology:"Solar",avg_price:61.7,min_price:42.0,max_price:75.0,deal_count:120},
    {year:2025,technology:"Onshore Wind",avg_price:73.8,min_price:55.0,max_price:92.0,deal_count:50},
    {year:2025,technology:"Offshore Wind",avg_price:100.0,min_price:80.0,max_price:135.0,deal_count:6},
    {year:2025,technology:"Solar + Storage",avg_price:67.7,min_price:50.0,max_price:85.0,deal_count:30},
    {year:2025,technology:"Standalone Storage",avg_price:75.0,min_price:58.0,max_price:95.0,deal_count:12},
  ];

  // Build buyers
  const bm = {};
  contracts.forEach(c => {
    if (!bm[c.buyer]) bm[c.buyer] = {buyer:c.buyer, total_capacity_mw:0, deal_count:0};
    bm[c.buyer].total_capacity_mw += c.capacity_mw;
    bm[c.buyer].deal_count++;
  });
  buyers = Object.values(bm).sort((a,b) => b.total_capacity_mw - a.total_capacity_mw);

  // Build sellers
  const sm = {};
  contracts.forEach(c => {
    if (!sm[c.seller]) sm[c.seller] = {seller:c.seller, total_capacity_mw:0, deal_count:0};
    sm[c.seller].total_capacity_mw += c.capacity_mw;
    sm[c.seller].deal_count++;
  });
  sellers = Object.values(sm).sort((a,b) => b.total_capacity_mw - a.total_capacity_mw);
}

// ============================================================
// RENDER
// ============================================================
function renderStats() {
  const g = document.getElementById('statsGrid');
  g.innerHTML =
    '<div class="stat-card"><div class="label">Total Contracts</div><div class="value">'+stats.total_contracts.toLocaleString()+'</div><div class="sub">Tracked PPAs</div></div>'+
    '<div class="stat-card"><div class="label">Total Capacity</div><div class="value">'+(stats.total_capacity_mw/1000).toFixed(1)+' GW</div><div class="sub">'+stats.total_capacity_mw.toLocaleString()+' MW</div></div>'+
    '<div class="stat-card"><div class="label">Avg Price</div><div class="value">$'+stats.avg_price_mwh.toFixed(1)+'</div><div class="sub">per MWh (disclosed deals)</div></div>'+
    '<div class="stat-card"><div class="label">Technologies</div><div class="value">'+Object.keys(stats.by_technology).length+'</div><div class="sub">Generation types</div></div>';
}

function renderFilters() {
  var make = function(cont, data, key) {
    var el = document.getElementById(cont);
    el.innerHTML = Object.entries(data).map(function(e) {
      return '<div class="filter-item" data-key="'+key+'" data-val="'+e[0]+'"><span>'+e[0]+'</span><span class="count">'+e[1]+'</span></div>';
    }).join('');
  };
  make('techFilters', stats.by_technology, 'technology');
  make('structFilters', stats.by_structure, 'structure');
  make('statusFilters', stats.by_status, 'status');
  var usRegions = {};
  var usKeys = ['ERCOT','PJM','MISO','CAISO','SPP','SERC','BPA','WECC','NYISO','ISONE'];
  Object.entries(stats.by_region).forEach(function(e) {
    if (usKeys.indexOf(e[0]) >= 0) usRegions[e[0]] = e[1];
    else usRegions['Other'] = (usRegions['Other']||0) + e[1];
  });
  make('regionFilters', usRegions, 'region');
  var bt = {};
  allContracts.forEach(function(c) { bt[c.buyer_type] = (bt[c.buyer_type]||0)+1; });
  make('buyerTypeFilters', bt, 'buyer_type');

  document.querySelectorAll('.filter-item').forEach(function(fi) {
    fi.onclick = function() {
      var k = fi.dataset.key, v = fi.dataset.val;
      if (filters[k] === v) { filters[k] = null; fi.classList.remove('active'); }
      else {
        document.querySelectorAll('.filter-item[data-key="'+k+'"]').forEach(function(x) { x.classList.remove('active'); });
        filters[k] = v; fi.classList.add('active');
      }
      page = 0;
      applyFilters();
      renderDeals();
    };
  });
}

function applyFilters() {
  var usKeys = ['ERCOT','PJM','MISO','CAISO','SPP','SERC','BPA','WECC','NYISO','ISONE'];
  filteredContracts = allContracts.filter(function(c) {
    if (filters.technology && c.technology !== filters.technology) return false;
    if (filters.structure && c.structure !== filters.structure) return false;
    if (filters.status && c.status !== filters.status) return false;
    if (filters.region) {
      if (filters.region === 'Other') {
        if (usKeys.indexOf(c.region) >= 0) return false;
      } else if (c.region !== filters.region) return false;
    }
    if (filters.buyer_type && c.buyer_type !== filters.buyer_type) return false;
    if (searchQ) {
      var q = searchQ.toLowerCase();
      if (!((c.buyer||'').toLowerCase().indexOf(q)>=0 || (c.seller||'').toLowerCase().indexOf(q)>=0 || (c.state||'').toLowerCase().indexOf(q)>=0 || (c.technology||'').toLowerCase().indexOf(q)>=0)) return false;
    }
    return true;
  });
}

function renderDeals() {
  var tb = document.getElementById('dealsBody');
  var start = page * pageSize;
  var pageData = filteredContracts.slice(start, start + pageSize);
  var t = filteredContracts.length;

  tb.innerHTML = pageData.map(function(c) {
    return '<tr class="deal-row" data-id="'+c.id+'" style="cursor:pointer">'+
      '<td><strong>'+esc(c.buyer)+'</strong></td>'+
      '<td>'+esc(c.seller)+'</td>'+
      '<td>'+techTag(c.technology)+'</td>'+
      '<td class="mono">'+c.capacity_mw.toLocaleString()+'</td>'+
      '<td class="mono">'+(c.price_mwh ? '$'+c.price_mwh.toFixed(2) : '—')+'</td>'+
      '<td><span class="tag">'+c.structure+'</span></td>'+
      '<td>'+c.state+'</td>'+
      '<td class="mono">'+c.term_years+'yr</td>'+
      '<td>'+statusTag(c.status)+'</td>'+
      '<td class="mono" style="font-size:12px">'+(c.announced_date||'')+'</td>'+
    '</tr>';
  }).join('') || '<tr><td colspan="10" class="empty">No contracts found</td></tr>';

  var pages = Math.ceil(t / pageSize);
  var pg = document.getElementById('dealsPagination');
  pg.innerHTML = '<span style="font-size:12px;color:var(--fg-dim)">'+t+' contracts</span>' +
    (pages > 1 ? '<button class="btn btn-sm" '+(page<=0?'disabled':'')+' onclick="page--;renderDeals()">← Prev</button>'+
    '<span class="mono" style="font-size:12px">'+(page+1)+' / '+pages+'</span>'+
    '<button class="btn btn-sm" '+(page>=pages-1?'disabled':'')+' onclick="page++;renderDeals()">Next →</button>' : '');

  document.querySelectorAll('.deal-row').forEach(function(r) {
    r.onclick = function() { showDetail(+r.dataset.id); };
  });
}

function showDetail(id) {
  var c = allContracts.find(function(x) { return x.id === id; });
  if (!c) return;
  var dp = document.getElementById('detailPanel');
  dp.innerHTML =
    '<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px">'+
      '<h3>'+esc(c.buyer)+' — '+esc(c.seller)+'</h3>'+
      '<button class="btn btn-sm btn-ghost" onclick="document.getElementById(\'detailOverlay\').classList.remove(\'show\')">✕</button>'+
    '</div>'+
    '<div class="detail-grid">'+
      '<div class="detail-field"><div class="label">Buyer</div><div class="val">'+esc(c.buyer)+'</div></div>'+
      '<div class="detail-field"><div class="label">Seller / Developer</div><div class="val">'+esc(c.seller)+'</div></div>'+
      '<div class="detail-field"><div class="label">Technology</div><div class="val">'+techTag(c.technology)+'</div></div>'+
      '<div class="detail-field"><div class="label">Capacity</div><div class="val mono">'+c.capacity_mw.toLocaleString()+' MW</div></div>'+
      '<div class="detail-field"><div class="label">Price</div><div class="val mono">'+(c.price_mwh?'$'+c.price_mwh.toFixed(2)+'/MWh':'Undisclosed')+'</div></div>'+
      '<div class="detail-field"><div class="label">Structure</div><div class="val">'+c.structure+'</div></div>'+
      '<div class="detail-field"><div class="label">Term</div><div class="val mono">'+c.term_years+' years</div></div>'+
      '<div class="detail-field"><div class="label">State / Location</div><div class="val">'+c.state+'</div></div>'+
      '<div class="detail-field"><div class="label">ISO/RTO</div><div class="val">'+(c.iso_rto||'—')+'</div></div>'+
      '<div class="detail-field"><div class="label">Region</div><div class="val">'+c.region+'</div></div>'+
      '<div class="detail-field"><div class="label">Status</div><div class="val">'+statusTag(c.status)+'</div></div>'+
      '<div class="detail-field"><div class="label">Announced</div><div class="val mono">'+c.announced_date+'</div></div>'+
      '<div class="detail-field"><div class="label">Buyer Type</div><div class="val">'+c.buyer_type+'</div></div>'+
      '<div class="detail-field"><div class="label">Source</div><div class="val">'+(c.source||'—')+'</div></div>'+
    '</div>';
  document.getElementById('detailOverlay').classList.add('show');
}
document.getElementById('detailOverlay').onclick = function(e) { if (e.target.id==='detailOverlay') e.target.classList.remove('show'); };

function renderPricingChart() {
  var years = []; pricing.forEach(function(p) { if (years.indexOf(p.year)<0) years.push(p.year); }); years.sort();
  var techs = []; pricing.forEach(function(p) { if (techs.indexOf(p.technology)<0) techs.push(p.technology); });
  var datasets = techs.map(function(t) {
    return {
      label: t,
      data: years.map(function(y) { var m = pricing.find(function(p) { return p.year===y && p.technology===t; }); return m ? m.avg_price : null; }),
      borderColor: TECH_COLORS[t]||'#888',
      backgroundColor: (TECH_COLORS[t]||'#888')+'33',
      tension: 0.3, fill: false, pointRadius: 4, borderWidth: 2,
    };
  });
  charts.pricing = new Chart(document.getElementById('pricingChart'), {
    type:'line', data:{labels:years, datasets:datasets},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},
      scales:{y:{title:{display:true,text:'$/MWh'},grid:{color:gridColor()}},x:{grid:{color:gridColor()}}}}
  });

  var recent = pricing.filter(function(p) { return p.year>=2024; });
  var rt = []; recent.forEach(function(p) { if (rt.indexOf(p.technology)<0) rt.push(p.technology); });
  charts.priceRange = new Chart(document.getElementById('priceRangeChart'), {
    type:'bar', data:{labels:rt,datasets:[
      {label:'Min',data:rt.map(function(t){var r=recent.filter(function(p){return p.technology===t;});return r.length?Math.min.apply(null,r.map(function(p){return p.min_price;})):0;}),backgroundColor:'#22c55e44',borderColor:'#22c55e',borderWidth:1},
      {label:'Avg',data:rt.map(function(t){var r=recent.filter(function(p){return p.technology===t;});return r.length?(r.reduce(function(s,p){return s+p.avg_price;},0)/r.length):0;}),backgroundColor:'#3b82f644',borderColor:'#3b82f6',borderWidth:1},
      {label:'Max',data:rt.map(function(t){var r=recent.filter(function(p){return p.technology===t;});return r.length?Math.max.apply(null,r.map(function(p){return p.max_price;})):0;}),backgroundColor:'#f59e0b44',borderColor:'#f59e0b',borderWidth:1},
    ]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},scales:{y:{title:{display:true,text:'$/MWh'},grid:{color:gridColor()}},x:{grid:{display:false}}}}
  });

  var byYear = stats.by_year || [];
  charts.volume = new Chart(document.getElementById('volumeChart'), {
    type:'bar', data:{labels:byYear.map(function(y){return y.year;}),datasets:[
      {label:'Contracts',data:byYear.map(function(y){return y.count;}),backgroundColor:'#3b82f6',borderRadius:4},
      {label:'GW',data:byYear.map(function(y){return (y.capacity_mw/1000).toFixed(1);}),backgroundColor:'#22c55e',borderRadius:4,yAxisID:'y1'},
    ]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},
      scales:{y:{position:'left',title:{display:true,text:'Contracts'},grid:{color:gridColor()}},y1:{position:'right',title:{display:true,text:'GW'},grid:{display:false}},x:{grid:{display:false}}}}
  });
}

function renderBuyers() {
  var list = document.getElementById('buyersList');
  list.innerHTML = buyers.slice(0,15).map(function(b,i) {
    return '<li><span class="rank">#'+(i+1)+'</span><span class="name">'+esc(b.buyer)+'</span><span class="val">'+b.total_capacity_mw.toLocaleString()+' MW</span><span style="font-size:11px;color:var(--fg-dim);margin-left:12px;width:50px;text-align:right">'+b.deal_count+' deals</span></li>';
  }).join('');
  charts.buyers = new Chart(document.getElementById('buyersChart'), {
    type:'doughnut',
    data:{labels:buyers.slice(0,10).map(function(b){return b.buyer;}),datasets:[{data:buyers.slice(0,10).map(function(b){return b.total_capacity_mw;}),
      backgroundColor:['#3b82f6','#22c55e','#f59e0b','#a855f7','#06b6d4','#ef4444','#ec4899','#84cc16','#f97316','#6366f1'],borderWidth:0}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{font:{size:11}}}}}
  });
}

function renderSellers() {
  var list = document.getElementById('sellersList');
  list.innerHTML = sellers.slice(0,15).map(function(s,i) {
    return '<li><span class="rank">#'+(i+1)+'</span><span class="name">'+esc(s.seller)+'</span><span class="val">'+s.total_capacity_mw.toLocaleString()+' MW</span><span style="font-size:11px;color:var(--fg-dim);margin-left:12px;width:50px;text-align:right">'+s.deal_count+' deals</span></li>';
  }).join('');
  charts.sellers = new Chart(document.getElementById('sellersChart'), {
    type:'doughnut',
    data:{labels:sellers.slice(0,10).map(function(s){return s.seller;}),datasets:[{data:sellers.slice(0,10).map(function(s){return s.total_capacity_mw;}),
      backgroundColor:['#22c55e','#3b82f6','#f59e0b','#a855f7','#06b6d4','#ef4444','#ec4899','#84cc16','#f97316','#6366f1'],borderWidth:0}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{font:{size:11}}}}}
  });
}

function renderAnalysis() {
  var techData = stats.by_technology||{};
  charts.tech = new Chart(document.getElementById('techChart'), {
    type:'doughnut',
    data:{labels:Object.keys(techData),datasets:[{data:Object.values(techData),
      backgroundColor:Object.keys(techData).map(function(t){return TECH_COLORS[t]||'#888';}),borderWidth:0}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right'}}}
  });
  var structData = stats.by_structure||{};
  charts.struct = new Chart(document.getElementById('structChart'), {
    type:'doughnut',
    data:{labels:Object.keys(structData),datasets:[{data:Object.values(structData),
      backgroundColor:Object.keys(structData).map(function(s){return STRUCT_COLORS[s]||'#888';}),borderWidth:0}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right'}}}
  });
  var regionData = stats.by_region||{};
  charts.region = new Chart(document.getElementById('regionChart'), {
    type:'bar',
    data:{labels:Object.keys(regionData),datasets:[{label:'Contracts',data:Object.values(regionData),backgroundColor:'#3b82f6',borderRadius:4}]},
    options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{grid:{color:gridColor()}},y:{grid:{display:false}}}}
  });
  var byYear = stats.by_year||[];
  charts.annualCap = new Chart(document.getElementById('annualCapChart'), {
    type:'bar',
    data:{labels:byYear.map(function(y){return y.year;}),datasets:[{label:'Capacity (MW)',data:byYear.map(function(y){return y.capacity_mw;}),backgroundColor:'#22c55e',borderRadius:4}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'MW'},grid:{color:gridColor()}},x:{grid:{display:false}}}}
  });
}

function renderHeatmap() {
  var byState = {};
  allContracts.forEach(function(c) {
    if (!byState[c.state]) byState[c.state] = {count:0, mw:0};
    byState[c.state].count++;
    byState[c.state].mw += c.capacity_mw||0;
  });
  var maxCount = Math.max.apply(null, Object.values(byState).map(function(s){return s.count;}));
  if (maxCount < 1) maxCount = 1;
  var grid = document.getElementById('heatmapGrid');
  grid.innerHTML = Object.entries(byState).sort(function(a,b){return b[1].count-a[1].count;}).map(function(e) {
    var st = e[0], d = e[1];
    var intensity = d.count / maxCount;
    var bg = 'hsla(142, 76%, 36%, '+(0.1 + intensity * 0.6)+')';
    return '<div class="heatmap-cell" style="background:'+bg+'"><span class="st">'+st+'</span>'+d.count+' deals<br>'+Math.round(d.mw).toLocaleString()+' MW</div>';
  }).join('');
}

// Search
var searchTimer;
document.getElementById('searchInput').oninput = function(e) {
  clearTimeout(searchTimer);
  searchTimer = setTimeout(function() { searchQ = e.target.value; page = 0; applyFilters(); renderDeals(); }, 300);
};

// Export
document.getElementById('exportBtn').onclick = function() {
  var rows = [['Buyer','Seller','Technology','MW','$/MWh','Structure','State','Term','Status','Date','Source']];
  filteredContracts.forEach(function(c) { rows.push([c.buyer,c.seller,c.technology,c.capacity_mw,c.price_mwh||'',c.structure,c.state,c.term_years,c.status,c.announced_date,c.source]); });
  var csv = rows.map(function(r){return r.map(function(v){return '"'+(v||'')+'"';}).join(',');}).join('\n');
  var blob = new Blob([csv],{type:'text/csv'});
  var a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ppa-database.csv'; a.click();
};

function esc(s){var d=document.createElement('div');d.textContent=s||'';return d.innerHTML;}

// ============================================================
// INIT
// ============================================================
function init() {
  buildStats();
  renderStats();
  renderFilters();
  renderDeals();
  renderPricingChart();
  renderBuyers();
  renderSellers();
  renderAnalysis();
  renderHeatmap();
}

init();
</script>
<script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
