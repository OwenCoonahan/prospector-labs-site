<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Energy Manufacturing Tracker ‚Äî Prospector Labs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:hsl(0 0% 3.9%);--bg-card:hsl(0 0% 5.9%);--bg-muted:hsl(0 0% 9%);
  --fg:hsl(0 0% 98%);--fg-muted:hsl(0 0% 63.9%);--fg-dim:hsl(0 0% 45%);
  --border:hsl(0 0% 14.9%);--ring:hsl(0 0% 83.1%);
  --accent:hsl(142 71% 45%);--accent-fg:hsl(144 61% 20%);
  --radius:0.5rem;--font:'Geist',system-ui,sans-serif;--mono:'Geist Mono',monospace;
  --c-solar:#facc15;--c-battery:#22c55e;--c-ev:#3b82f6;--c-wind:#06b6d4;--c-semiconductor:#a855f7;--c-other:#f97316;
}
[data-theme="light"]{
  --bg:hsl(0 0% 100%);--bg-card:hsl(0 0% 98%);--bg-muted:hsl(0 0% 96.1%);
  --fg:hsl(0 0% 3.9%);--fg-muted:hsl(0 0% 45.1%);--fg-dim:hsl(0 0% 63%);
  --border:hsl(0 0% 89.8%);--ring:hsl(0 0% 14.9%);
}
html{font-family:var(--font);background:var(--bg);color:var(--fg);font-size:14px;line-height:1.5}
body{min-height:100vh}
a{color:var(--accent);text-decoration:none}
.app{display:grid;grid-template-rows:auto 1fr;height:100vh;overflow:hidden}
header{display:flex;align-items:center;justify-content:space-between;padding:0.75rem 1.25rem;border-bottom:1px solid var(--border);background:var(--bg-card)}
header h1{font-size:1.1rem;font-weight:600;letter-spacing:-0.02em}
header .subtitle{font-size:0.8rem;color:var(--fg-muted);font-family:var(--mono)}
.header-right{display:flex;align-items:center;gap:0.75rem}
.theme-toggle{background:none;border:1px solid var(--border);border-radius:var(--radius);padding:0.35rem 0.6rem;color:var(--fg);cursor:pointer;font-size:0.85rem}
.theme-toggle:hover{background:var(--bg-muted)}
.main{display:grid;grid-template-columns:340px 1fr;overflow:hidden}
.sidebar{overflow-y:auto;border-right:1px solid var(--border);background:var(--bg-card);display:flex;flex-direction:column}
.content{overflow-y:auto;display:flex;flex-direction:column}
.filters{padding:1rem;border-bottom:1px solid var(--border)}
.filters h2{font-size:0.75rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--fg-muted);margin-bottom:0.75rem}
.filter-group{margin-bottom:0.75rem}
.filter-group label{display:block;font-size:0.75rem;color:var(--fg-dim);margin-bottom:0.3rem;font-family:var(--mono)}
.filter-group select,.filter-group input{width:100%;padding:0.4rem 0.6rem;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);color:var(--fg);font-family:var(--font);font-size:0.85rem}
.filter-group select:focus,.filter-group input:focus{outline:none;border-color:var(--ring)}
.filter-chips{display:flex;flex-wrap:wrap;gap:0.35rem;margin-top:0.35rem}
.chip{font-size:0.7rem;padding:0.2rem 0.5rem;border-radius:999px;border:1px solid var(--border);background:var(--bg);color:var(--fg-muted);cursor:pointer;font-family:var(--mono);transition:all 0.15s}
.chip:hover,.chip.active{border-color:var(--accent);color:var(--accent);background:var(--accent-fg)}
.stats-bar{display:grid;grid-template-columns:repeat(4,1fr);gap:0.5rem;padding:1rem}
.stat-card{background:var(--bg-muted);border:1px solid var(--border);border-radius:var(--radius);padding:0.75rem}
.stat-card .label{font-size:0.65rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--fg-dim);font-family:var(--mono)}
.stat-card .value{font-size:1.4rem;font-weight:700;letter-spacing:-0.03em;margin-top:0.15rem}
.stat-card .sub{font-size:0.7rem;color:var(--fg-muted);font-family:var(--mono)}
.facility-list{flex:1;overflow-y:auto;padding:0.5rem}
.facility-item{padding:0.6rem 0.75rem;border-radius:var(--radius);cursor:pointer;border:1px solid transparent;margin-bottom:0.25rem;transition:all 0.15s}
.facility-item:hover{background:var(--bg-muted);border-color:var(--border)}
.facility-item.active{background:var(--bg-muted);border-color:var(--accent)}
.facility-item .fi-name{font-weight:500;font-size:0.85rem}
.facility-item .fi-company{font-size:0.75rem;color:var(--fg-muted)}
.facility-item .fi-meta{display:flex;gap:0.5rem;margin-top:0.25rem;font-size:0.7rem;font-family:var(--mono);color:var(--fg-dim)}
.fi-badge{display:inline-block;padding:0.1rem 0.4rem;border-radius:999px;font-size:0.65rem;font-weight:500}
.fi-count{font-size:0.75rem;color:var(--fg-dim);padding:0.5rem 0.75rem;font-family:var(--mono)}
.map-wrap{flex:1;position:relative;min-height:400px}
#map{width:100%;height:100%}
.dashboard{display:grid;grid-template-columns:1fr 1fr;gap:1rem;padding:1rem}
.panel{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:1rem}
.panel h3{font-size:0.75rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--fg-muted);margin-bottom:0.75rem;font-family:var(--mono)}
.panel canvas{width:100%!important;max-height:250px}
.tabs{display:flex;border-bottom:1px solid var(--border);padding:0 1rem}
.tab{padding:0.6rem 1rem;font-size:0.8rem;color:var(--fg-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.15s;font-family:var(--mono)}
.tab:hover{color:var(--fg)}
.tab.active{color:var(--fg);border-bottom-color:var(--accent)}
.tab-content{display:none}.tab-content.active{display:flex;flex-direction:column;flex:1;overflow:hidden}
.mapboxgl-popup-content{background:var(--bg-card)!important;color:var(--fg)!important;border:1px solid var(--border)!important;border-radius:var(--radius)!important;padding:1rem!important;font-family:var(--font)!important;min-width:260px}
.mapboxgl-popup-tip{border-top-color:var(--border)!important}
.mapboxgl-popup-close-button{color:var(--fg-muted)!important;font-size:1.2rem!important}
.popup-title{font-weight:600;font-size:0.95rem;margin-bottom:0.25rem}
.popup-company{color:var(--fg-muted);font-size:0.8rem;margin-bottom:0.5rem}
.popup-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.4rem}
.popup-grid .pg-label{font-size:0.65rem;text-transform:uppercase;color:var(--fg-dim);font-family:var(--mono)}
.popup-grid .pg-value{font-size:0.85rem;font-weight:500}
.popup-funding{margin-top:0.5rem;border-top:1px solid var(--border);padding-top:0.5rem}
.popup-funding .pf-item{display:flex;justify-content:space-between;font-size:0.75rem;padding:0.15rem 0}
.popup-funding .pf-source{color:var(--fg-muted);font-family:var(--mono)}
@media(max-width:900px){
  .main{grid-template-columns:1fr}
  .sidebar{max-height:40vh}
  .dashboard{grid-template-columns:1fr}
  .stats-bar{grid-template-columns:repeat(2,1fr)}
}
</style>
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"></head>
<body>
<div class="app">
  <header>
    <div>
      <h1>üè≠ Clean Energy Manufacturing Tracker</h1>
      <div class="subtitle">Prospector Labs ¬∑ IRA ¬∑ CHIPS Act ¬∑ DOE LPO</div>
    </div>
    <div class="header-right">
      <span style="font-size:0.7rem;font-family:var(--mono);color:var(--fg-dim)">50 facilities ¬∑ $100B+ tracked</span>
      <button class="theme-toggle" onclick="toggleTheme()">‚óê</button>
    </div>
  </header>
  <div class="main">
    <div class="sidebar">
      <div class="filters">
        <h2>Filters</h2>
        <div class="filter-group">
          <label>Technology</label>
          <div class="filter-chips" id="techFilters">
            <span class="chip active" data-val="">All</span>
            <span class="chip" data-val="solar">‚òÄ Solar</span>
            <span class="chip" data-val="battery">üîã Battery</span>
            <span class="chip" data-val="ev">üöó EV</span>
            <span class="chip" data-val="wind">üí® Wind</span>
            <span class="chip" data-val="semiconductor">üíé Semi</span>
          </div>
        </div>
        <div class="filter-group">
          <label>Status</label>
          <div class="filter-chips" id="statusFilters">
            <span class="chip active" data-val="">All</span>
            <span class="chip" data-val="announced">Announced</span>
            <span class="chip" data-val="construction">Construction</span>
            <span class="chip" data-val="operational">Operational</span>
            <span class="chip" data-val="delayed">Delayed</span>
          </div>
        </div>
        <div class="filter-group">
          <label>Funding Source</label>
          <select id="fundingFilter">
            <option value="">All Sources</option>
            <option value="IRA_48C">IRA 48C Tax Credit</option>
            <option value="CHIPS">CHIPS Act</option>
            <option value="DOE_LPO">DOE Loan Programs</option>
            <option value="state">State Incentives</option>
            <option value="private">Private</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Search</label>
          <input type="text" id="searchInput" placeholder="Company, city, state‚Ä¶">
        </div>
      </div>
      <div class="fi-count" id="facilityCount">Loading‚Ä¶</div>
      <div class="facility-list" id="facilityList"></div>
    </div>
    <div class="content">
      <div class="tabs">
        <div class="tab active" data-tab="map">Map</div>
        <div class="tab" data-tab="dashboard">Investment</div>
        <div class="tab" data-tab="jobs">Jobs</div>
        <div class="tab" data-tab="funding">Funding</div>
        <div class="tab" data-tab="timeline">Timeline</div>
      </div>
      <div class="tab-content active" id="tab-map">
        <div class="stats-bar" id="statsBar"></div>
        <div class="map-wrap"><div id="map"></div></div>
      </div>
      <div class="tab-content" id="tab-dashboard">
        <div class="stats-bar" id="statsBar2"></div>
        <div class="dashboard">
          <div class="panel"><h3>Investment by Technology</h3><canvas id="chartTech"></canvas></div>
          <div class="panel"><h3>Investment by State (Top 10)</h3><canvas id="chartState"></canvas></div>
        </div>
      </div>
      <div class="tab-content" id="tab-jobs">
        <div class="dashboard" style="grid-template-columns:1fr">
          <div class="panel"><h3>Jobs: Announced vs Created by Sector</h3><canvas id="chartJobs"></canvas></div>
        </div>
      </div>
      <div class="tab-content" id="tab-funding">
        <div class="dashboard">
          <div class="panel"><h3>Funding Source Breakdown</h3><canvas id="chartFunding"></canvas></div>
          <div class="panel"><h3>Federal vs State vs Private</h3><canvas id="chartFundingPie"></canvas></div>
        </div>
      </div>
      <div class="tab-content" id="tab-timeline">
        <div class="dashboard" style="grid-template-columns:1fr">
          <div class="panel"><h3>Facility Announcements Over Time</h3><canvas id="chartTimeline"></canvas></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const MAPBOX_TOKEN='pk.eyJ1IjoicHJvc3BlY3Rvci1sYWJzIiwiYSI6ImNtNWRtYm0wajBkbGgyanM2cW1wbDQ3OXoifQ.demo';
const TECH_COLORS={solar:'#facc15',battery:'#22c55e',ev:'#3b82f6',wind:'#06b6d4',semiconductor:'#a855f7',hydrogen:'#f97316',other:'#f97316'};
const STATUS_LABELS={announced:'Announced',construction:'Under Construction',operational:'Operational',delayed:'Delayed',cancelled:'Cancelled'};

// ‚îÄ‚îÄ‚îÄ EMBEDDED REAL DATA: 50 Clean Energy Manufacturing Facilities ‚îÄ‚îÄ‚îÄ
const FACILITIES_DATA=[
  {id:1,name:"First Solar Module Factory (Series 7)",company:"First Solar",technology:"solar",city:"Perrysburg",state:"OH",lat:41.557,lng:-83.627,investment_total:680000000,jobs_announced:500,jobs_created:500,status:"operational",announced_date:"2021-06-29",funding_sources:[{source:"IRA_48C",amount:170000000}]},
  {id:2,name:"First Solar Module Factory",company:"First Solar",technology:"solar",city:"Lake Township",state:"OH",lat:41.25,lng:-81.37,investment_total:270000000,jobs_announced:500,jobs_created:500,status:"operational",announced_date:"2022-08-30",funding_sources:[{source:"IRA_48C",amount:80000000}]},
  {id:3,name:"First Solar Module Factory (3rd US Plant)",company:"First Solar",technology:"solar",city:"Lawrence County",state:"AL",lat:34.67,lng:-87.33,investment_total:1100000000,jobs_announced:700,jobs_created:350,status:"construction",announced_date:"2023-01-25",funding_sources:[{source:"IRA_48C",amount:272000000},{source:"state",amount:45000000}]},
  {id:4,name:"First Solar Module Factory (Louisiana)",company:"First Solar",technology:"solar",city:"Iberia Parish",state:"LA",lat:30.0,lng:-91.83,investment_total:1100000000,jobs_announced:700,jobs_created:0,status:"construction",announced_date:"2024-07-16",funding_sources:[{source:"IRA_48C",amount:200000000},{source:"state",amount:90000000}]},
  {id:5,name:"Qcells Complete Solar Supply Chain",company:"Hanwha Qcells",technology:"solar",city:"Dalton",state:"GA",lat:34.77,lng:-84.97,investment_total:2500000000,jobs_announced:2500,jobs_created:2000,status:"operational",announced_date:"2023-01-11",funding_sources:[{source:"IRA_48C",amount:150000000},{source:"DOE_LPO",amount:1450000000},{source:"state",amount:60000000}]},
  {id:6,name:"Qcells Ingot & Wafer Facility",company:"Hanwha Qcells",technology:"solar",city:"Cartersville",state:"GA",lat:34.17,lng:-84.8,investment_total:147000000,jobs_announced:160,jobs_created:160,status:"operational",announced_date:"2023-03-23",funding_sources:[{source:"private",amount:147000000}]},
  {id:7,name:"Maxeon Solar Panel Factory",company:"Maxeon Solar",technology:"solar",city:"Albuquerque",state:"NM",lat:35.08,lng:-106.65,investment_total:1000000000,jobs_announced:1800,jobs_created:0,status:"announced",announced_date:"2023-08-14",funding_sources:[{source:"IRA_48C",amount:200000000}]},
  {id:8,name:"Canadian Solar Module Facility",company:"Canadian Solar",technology:"solar",city:"Mesquite",state:"TX",lat:32.77,lng:-96.6,investment_total:250000000,jobs_announced:1500,jobs_created:1000,status:"operational",announced_date:"2023-03-08",funding_sources:[{source:"private",amount:250000000}]},
  {id:9,name:"Meyer Burger Solar Cell Factory",company:"Meyer Burger",technology:"solar",city:"Goodyear",state:"AZ",lat:33.43,lng:-112.36,investment_total:333000000,jobs_announced:350,jobs_created:0,status:"delayed",announced_date:"2022-03-08",funding_sources:[{source:"IRA_48C",amount:85000000}]},
  {id:10,name:"Enel 3Sun Solar GigaFactory",company:"Enel",technology:"solar",city:"Tulsa",state:"OK",lat:36.15,lng:-95.99,investment_total:1000000000,jobs_announced:1000,jobs_created:0,status:"delayed",announced_date:"2023-06-13",funding_sources:[{source:"DOE_LPO",amount:500000000}]},
  {id:11,name:"Tesla Gigafactory Nevada",company:"Tesla / Panasonic",technology:"battery",city:"Sparks",state:"NV",lat:39.54,lng:-119.44,investment_total:6500000000,jobs_announced:11000,jobs_created:11000,status:"operational",announced_date:"2014-09-04",funding_sources:[{source:"state",amount:1300000000},{source:"private",amount:5200000000}]},
  {id:12,name:"Tesla Gigafactory Texas",company:"Tesla",technology:"ev",city:"Austin",state:"TX",lat:30.22,lng:-97.62,investment_total:5600000000,jobs_announced:20000,jobs_created:12000,status:"operational",announced_date:"2020-07-22",funding_sources:[{source:"state",amount:65000000},{source:"private",amount:5535000000}]},
  {id:13,name:"Panasonic EV Battery Gigafactory",company:"Panasonic Energy",technology:"battery",city:"De Soto",state:"KS",lat:38.97,lng:-94.97,investment_total:4000000000,jobs_announced:4000,jobs_created:2000,status:"operational",announced_date:"2022-07-13",funding_sources:[{source:"IRA_48C",amount:6800000000},{source:"state",amount:829000000}]},
  {id:14,name:"LG Energy Solution Battery Plant",company:"LG Energy Solution",technology:"battery",city:"Holland",state:"MI",lat:42.79,lng:-86.11,investment_total:1700000000,jobs_announced:1200,jobs_created:1200,status:"operational",announced_date:"2021-03-24",funding_sources:[{source:"DOE_LPO",amount:2000000000},{source:"state",amount:100000000}]},
  {id:15,name:"Ultium Cells (GM/LG) Battery Plant",company:"Ultium Cells (GM/LG)",technology:"battery",city:"Warren",state:"OH",lat:41.24,lng:-80.82,investment_total:2300000000,jobs_announced:1100,jobs_created:1100,status:"operational",announced_date:"2021-01-25",funding_sources:[{source:"DOE_LPO",amount:2500000000}]},
  {id:16,name:"Ultium Cells Battery Plant 2",company:"Ultium Cells (GM/LG)",technology:"battery",city:"Spring Hill",state:"TN",lat:35.75,lng:-86.93,investment_total:2300000000,jobs_announced:1300,jobs_created:1000,status:"operational",announced_date:"2021-04-16",funding_sources:[{source:"private",amount:2300000000}]},
  {id:17,name:"Ultium Cells Battery Plant 3",company:"Ultium Cells (GM/LG)",technology:"battery",city:"Lansing",state:"MI",lat:42.73,lng:-84.56,investment_total:2600000000,jobs_announced:1700,jobs_created:500,status:"construction",announced_date:"2022-01-25",funding_sources:[{source:"private",amount:2600000000}]},
  {id:18,name:"SK Battery America Plant 1",company:"SK On",technology:"battery",city:"Commerce",state:"GA",lat:34.2,lng:-83.46,investment_total:2600000000,jobs_announced:2600,jobs_created:2600,status:"operational",announced_date:"2019-03-19",funding_sources:[{source:"state",amount:300000000},{source:"private",amount:2300000000}]},
  {id:19,name:"BlueOval SK Battery Park",company:"Ford / SK On",technology:"battery",city:"Glendale",state:"KY",lat:37.6,lng:-86.0,investment_total:5800000000,jobs_announced:5000,jobs_created:1500,status:"construction",announced_date:"2021-09-27",funding_sources:[{source:"DOE_LPO",amount:9200000000},{source:"state",amount:250000000}]},
  {id:20,name:"BlueOval SK Battery Plant (TN)",company:"Ford / SK On",technology:"battery",city:"Stanton",state:"TN",lat:35.46,lng:-89.39,investment_total:5600000000,jobs_announced:2500,jobs_created:0,status:"delayed",announced_date:"2021-09-27",funding_sources:[{source:"private",amount:5600000000}]},
  {id:21,name:"Samsung SDI Battery Plant",company:"Samsung SDI / Stellantis",technology:"battery",city:"Kokomo",state:"IN",lat:40.49,lng:-86.13,investment_total:3200000000,jobs_announced:1400,jobs_created:400,status:"construction",announced_date:"2022-05-24",funding_sources:[{source:"private",amount:3200000000}]},
  {id:22,name:"Samsung SDI ESS Battery Factory",company:"Samsung SDI",technology:"battery",city:"Queen Creek",state:"AZ",lat:33.25,lng:-111.63,investment_total:1960000000,jobs_announced:960,jobs_created:0,status:"construction",announced_date:"2024-06-05",funding_sources:[{source:"private",amount:1960000000}]},
  {id:23,name:"Toyota EV Battery Plant",company:"Toyota",technology:"battery",city:"Liberty",state:"NC",lat:35.85,lng:-79.57,investment_total:13900000000,jobs_announced:5100,jobs_created:2000,status:"construction",announced_date:"2021-12-06",funding_sources:[{source:"private",amount:13900000000}]},
  {id:24,name:"Honda/LG EV Battery Plant",company:"Honda / LG Energy",technology:"battery",city:"Fayette County",state:"OH",lat:39.56,lng:-83.56,investment_total:4400000000,jobs_announced:2527,jobs_created:500,status:"construction",announced_date:"2023-02-02",funding_sources:[{source:"private",amount:4400000000},{source:"state",amount:237000000}]},
  {id:25,name:"AESC Battery Gigafactory",company:"AESC (Envision)",technology:"battery",city:"Florence",state:"SC",lat:34.2,lng:-79.76,investment_total:810000000,jobs_announced:1170,jobs_created:400,status:"construction",announced_date:"2022-12-06",funding_sources:[{source:"private",amount:810000000}]},
  {id:26,name:"Hyundai Motor Group EV Plant",company:"Hyundai Motor Group",technology:"ev",city:"Ellabell",state:"GA",lat:32.13,lng:-81.47,investment_total:7600000000,jobs_announced:8500,jobs_created:1000,status:"construction",announced_date:"2022-05-20",funding_sources:[{source:"DOE_LPO",amount:7500000000},{source:"state",amount:1800000000}]},
  {id:27,name:"Rivian EV Manufacturing Plant",company:"Rivian",technology:"ev",city:"Normal",state:"IL",lat:40.52,lng:-88.99,investment_total:5000000000,jobs_announced:7500,jobs_created:7500,status:"operational",announced_date:"2017-01-15",funding_sources:[{source:"state",amount:49000000},{source:"private",amount:4951000000}]},
  {id:28,name:"Lucid Motors AMP-1",company:"Lucid Motors",technology:"ev",city:"Casa Grande",state:"AZ",lat:32.88,lng:-111.76,investment_total:700000000,jobs_announced:3000,jobs_created:2500,status:"operational",announced_date:"2019-11-19",funding_sources:[{source:"state",amount:48000000},{source:"private",amount:652000000}]},
  {id:29,name:"VinFast EV Factory",company:"VinFast",technology:"ev",city:"Chatham County",state:"NC",lat:35.71,lng:-79.17,investment_total:4000000000,jobs_announced:7500,jobs_created:0,status:"construction",announced_date:"2022-03-29",funding_sources:[{source:"state",amount:400000000},{source:"private",amount:3600000000}]},
  {id:30,name:"Scout Motors EV Plant",company:"Scout Motors (VW)",technology:"ev",city:"Blythewood",state:"SC",lat:34.22,lng:-80.97,investment_total:2000000000,jobs_announced:4000,jobs_created:0,status:"construction",announced_date:"2023-03-03",funding_sources:[{source:"state",amount:300000000},{source:"private",amount:1700000000}]},
  {id:31,name:"GE Vernova Wind Turbine Nacelle Factory",company:"GE Vernova",technology:"wind",city:"Schenectady",state:"NY",lat:42.81,lng:-73.94,investment_total:50000000,jobs_announced:200,jobs_created:200,status:"operational",announced_date:"2021-05-10",funding_sources:[{source:"private",amount:50000000}]},
  {id:32,name:"GE Vernova Offshore Wind Facility",company:"GE Vernova",technology:"wind",city:"Pensacola",state:"FL",lat:30.44,lng:-87.22,investment_total:20000000,jobs_announced:150,jobs_created:150,status:"operational",announced_date:"2022-06-01",funding_sources:[{source:"private",amount:20000000}]},
  {id:33,name:"Vestas Wind Turbine Blade Factory",company:"Vestas",technology:"wind",city:"Windsor",state:"CO",lat:40.48,lng:-104.9,investment_total:40000000,jobs_announced:1400,jobs_created:1400,status:"operational",announced_date:"2008-03-01",funding_sources:[{source:"state",amount:5000000},{source:"private",amount:35000000}]},
  {id:34,name:"Siemens Gamesa Wind Turbine Blade Factory",company:"Siemens Gamesa",technology:"wind",city:"Portsmouth",state:"VA",lat:36.84,lng:-76.3,investment_total:200000000,jobs_announced:310,jobs_created:310,status:"operational",announced_date:"2017-11-01",funding_sources:[{source:"state",amount:14000000},{source:"private",amount:186000000}]},
  {id:35,name:"TPI Composites Wind Blade Factory",company:"TPI Composites",technology:"wind",city:"Newton",state:"IA",lat:41.7,lng:-93.05,investment_total:30000000,jobs_announced:800,jobs_created:800,status:"operational",announced_date:"2008-01-15",funding_sources:[{source:"state",amount:10000000},{source:"private",amount:20000000}]},
  {id:36,name:"CS Wind Offshore Tower Factory",company:"CS Wind",technology:"wind",city:"Goldsboro",state:"NC",lat:35.38,lng:-77.99,investment_total:200000000,jobs_announced:900,jobs_created:200,status:"construction",announced_date:"2024-06-01",funding_sources:[{source:"DOE_LPO",amount:100000000},{source:"private",amount:100000000}]},
  {id:37,name:"Plug Power Electrolyzer Gigafactory",company:"Plug Power",technology:"hydrogen",city:"Vista",state:"NY",lat:43.09,lng:-73.87,investment_total:125000000,jobs_announced:82,jobs_created:82,status:"operational",announced_date:"2022-11-01",funding_sources:[{source:"DOE_LPO",amount:1660000000}]},
  {id:38,name:"Nel Hydrogen Electrolyzer Factory",company:"Nel Hydrogen",technology:"hydrogen",city:"Wallingford",state:"CT",lat:41.45,lng:-72.82,investment_total:500000000,jobs_announced:500,jobs_created:0,status:"construction",announced_date:"2023-09-14",funding_sources:[{source:"private",amount:500000000}]},
  {id:39,name:"Bloom Energy Solid Oxide Fuel Cell Factory",company:"Bloom Energy",technology:"hydrogen",city:"Fremont",state:"CA",lat:37.55,lng:-121.98,investment_total:200000000,jobs_announced:300,jobs_created:300,status:"operational",announced_date:"2019-01-15",funding_sources:[{source:"private",amount:200000000}]},
  {id:40,name:"Electric Hydrogen Electrolyzer Plant",company:"Electric Hydrogen",technology:"hydrogen",city:"Devens",state:"MA",lat:42.54,lng:-71.62,investment_total:100000000,jobs_announced:200,jobs_created:100,status:"construction",announced_date:"2023-07-20",funding_sources:[{source:"DOE_LPO",amount:100000000},{source:"private",amount:50000000}]},
  {id:41,name:"Sila Nanotechnologies Anode Factory",company:"Sila Nanotechnologies",technology:"battery",city:"Moses Lake",state:"WA",lat:47.13,lng:-119.28,investment_total:600000000,jobs_announced:300,jobs_created:150,status:"construction",announced_date:"2023-02-15",funding_sources:[{source:"DOE_LPO",amount:100000000},{source:"private",amount:500000000}]},
  {id:42,name:"Ascend Elements Battery Recycling Apex 1",company:"Ascend Elements",technology:"battery",city:"Hopkinsville",state:"KY",lat:36.87,lng:-87.49,investment_total:1000000000,jobs_announced:400,jobs_created:100,status:"construction",announced_date:"2023-04-18",funding_sources:[{source:"DOE_LPO",amount:480000000},{source:"private",amount:520000000}]},
  {id:43,name:"Redwood Materials Battery Recycling Campus",company:"Redwood Materials",technology:"battery",city:"McCarran",state:"NV",lat:39.56,lng:-119.55,investment_total:3500000000,jobs_announced:1600,jobs_created:800,status:"construction",announced_date:"2022-07-28",funding_sources:[{source:"DOE_LPO",amount:2000000000},{source:"private",amount:1500000000}]},
  {id:44,name:"Redwood Materials East Coast Campus",company:"Redwood Materials",technology:"battery",city:"Ridgeville",state:"SC",lat:33.1,lng:-80.32,investment_total:3500000000,jobs_announced:1500,jobs_created:0,status:"construction",announced_date:"2023-08-24",funding_sources:[{source:"private",amount:3500000000}]},
  {id:45,name:"CATL/Ford LFP Battery Plant",company:"CATL / Ford",technology:"battery",city:"Marshall",state:"MI",lat:42.27,lng:-84.96,investment_total:3500000000,jobs_announced:2500,jobs_created:0,status:"construction",announced_date:"2023-02-13",funding_sources:[{source:"private",amount:3500000000}]},
  {id:46,name:"Volkswagen EV Plant (Chattanooga expansion)",company:"Volkswagen",technology:"ev",city:"Chattanooga",state:"TN",lat:35.05,lng:-85.31,investment_total:800000000,jobs_announced:1000,jobs_created:500,status:"operational",announced_date:"2022-03-18",funding_sources:[{source:"private",amount:800000000}]},
  {id:47,name:"BMW EV Battery Assembly Plant",company:"BMW",technology:"ev",city:"Woodruff",state:"SC",lat:34.74,lng:-82.04,investment_total:1700000000,jobs_announced:300,jobs_created:300,status:"operational",announced_date:"2022-10-19",funding_sources:[{source:"private",amount:1700000000}]},
  {id:48,name:"SunPower / Maxeon Module Assembly",company:"SunPower",technology:"solar",city:"Salem",state:"OR",lat:44.94,lng:-123.03,investment_total:85000000,jobs_announced:400,jobs_created:400,status:"operational",announced_date:"2021-12-01",funding_sources:[{source:"private",amount:85000000}]},
  {id:49,name:"Solaria Solar Module Factory",company:"Solaria",technology:"solar",city:"Fremont",state:"CA",lat:37.55,lng:-121.98,investment_total:20000000,jobs_announced:50,jobs_created:50,status:"operational",announced_date:"2022-04-01",funding_sources:[{source:"private",amount:20000000}]},
  {id:50,name:"Enphase Microinverter Factory",company:"Enphase Energy",technology:"solar",city:"Timmonsville",state:"SC",lat:34.13,lng:-79.94,investment_total:60000000,jobs_announced:600,jobs_created:300,status:"operational",announced_date:"2023-06-01",funding_sources:[{source:"IRA_48C",amount:20000000},{source:"private",amount:40000000}]}
];

let allFacilities=[],filteredFacilities=[],map,markers=[],charts={};
let filters={technology:'',status:'',funding:'',q:''};

function toggleTheme(){
  const t=document.documentElement.dataset.theme==='dark'?'light':'dark';
  document.documentElement.dataset.theme=t;
  if(map)map.setStyle(t==='dark'?'mapbox://styles/mapbox/dark-v11':'mapbox://styles/mapbox/light-v11');
  Object.values(charts).forEach(c=>c.destroy());charts={};
  setTimeout(()=>renderCharts(),500);
}

function fmt$(n){if(!n)return'‚Äî';if(n>=1e9)return`$${(n/1e9).toFixed(1)}B`;if(n>=1e6)return`$${(n/1e6).toFixed(0)}M`;return`$${n.toLocaleString()}`}
function fmtNum(n){return n?n.toLocaleString():'‚Äî'}

async function init(){
  allFacilities=FACILITIES_DATA;
  applyFilters();initMap();renderCharts();setupEvents();
  document.querySelector('.header-right span').textContent=`${allFacilities.length} facilities ¬∑ ${fmt$(allFacilities.reduce((s,f)=>s+(f.investment_total||0),0))}+ tracked`;
}

function applyFilters(){
  filteredFacilities=allFacilities.filter(f=>{
    if(filters.technology&&f.technology!==filters.technology)return false;
    if(filters.status&&f.status!==filters.status)return false;
    if(filters.q){const q=filters.q.toLowerCase();if(!((f.name||'').toLowerCase().includes(q)||(f.company||'').toLowerCase().includes(q)||(f.city||'').toLowerCase().includes(q)||(f.state||'').toLowerCase().includes(q)))return false}
    return true;
  });
  renderList();renderStats();updateMapMarkers();
}

function renderStats(){
  const ti=filteredFacilities.reduce((s,f)=>s+(f.investment_total||0),0);
  const tj=filteredFacilities.reduce((s,f)=>s+(f.jobs_announced||0),0);
  const tc=filteredFacilities.reduce((s,f)=>s+(f.jobs_created||0),0);
  const h=`<div class="stat-card"><div class="label">Facilities</div><div class="value">${filteredFacilities.length}</div></div>
    <div class="stat-card"><div class="label">Total Investment</div><div class="value">${fmt$(ti)}</div></div>
    <div class="stat-card"><div class="label">Jobs Announced</div><div class="value">${fmtNum(tj)}</div></div>
    <div class="stat-card"><div class="label">Jobs Created</div><div class="value">${fmtNum(tc)}</div><div class="sub">${tj?Math.round(tc/tj*100):0}% of announced</div></div>`;
  document.getElementById('statsBar').innerHTML=h;
  document.getElementById('statsBar2').innerHTML=h;
}

function renderList(){
  const el=document.getElementById('facilityList');
  document.getElementById('facilityCount').textContent=`${filteredFacilities.length} facilities`;
  el.innerHTML=filteredFacilities.map(f=>`
    <div class="facility-item" data-id="${f.id}" onclick="selectFacility(${f.id})">
      <div class="fi-name">${f.name}</div>
      <div class="fi-company">${f.company}</div>
      <div class="fi-meta">
        <span class="fi-badge" style="background:${TECH_COLORS[f.technology]||TECH_COLORS.other};color:#000">${f.technology}</span>
        <span>${STATUS_LABELS[f.status]||f.status}</span>
        <span>${fmt$(f.investment_total)}</span>
        <span>${f.state}</span>
      </div>
    </div>`).join('');
}

function initMap(){
  mapboxgl.accessToken=MAPBOX_TOKEN;
  map=new mapboxgl.Map({container:'map',style:'mapbox://styles/mapbox/dark-v11',center:[-98,39],zoom:3.8,attributionControl:false});
  map.addControl(new mapboxgl.NavigationControl(),'top-right');
  map.on('load',()=>updateMapMarkers());
}

function updateMapMarkers(){
  markers.forEach(m=>m.remove());markers=[];
  if(!map)return;
  filteredFacilities.forEach(f=>{
    if(!f.lat||!f.lng)return;
    const el=document.createElement('div');
    el.style.cssText=`width:14px;height:14px;border-radius:50%;background:${TECH_COLORS[f.technology]||TECH_COLORS.other};border:2px solid rgba(255,255,255,0.8);cursor:pointer;transition:transform 0.15s;`;
    el.addEventListener('mouseenter',()=>el.style.transform='scale(1.5)');
    el.addEventListener('mouseleave',()=>el.style.transform='scale(1)');
    const marker=new mapboxgl.Marker({element:el}).setLngLat([f.lng,f.lat]).addTo(map);
    marker.getElement().addEventListener('click',()=>showPopup(f));
    markers.push(marker);
  });
}

async function showPopup(f){
  const d=f;
  const funding=(d.funding_sources||[]).map(s=>`<div class="pf-item"><span class="pf-source">${s.source}</span><span>${fmt$(s.amount)}</span></div>`).join('');
  new mapboxgl.Popup({maxWidth:'320px'}).setLngLat([f.lng,f.lat]).setHTML(`
    <div class="popup-title">${f.name}</div>
    <div class="popup-company">${f.company} ¬∑ ${f.city}, ${f.state}</div>
    <div class="popup-grid">
      <div><div class="pg-label">Investment</div><div class="pg-value">${fmt$(f.investment_total)}</div></div>
      <div><div class="pg-label">Status</div><div class="pg-value">${STATUS_LABELS[f.status]||f.status}</div></div>
      <div><div class="pg-label">Jobs Announced</div><div class="pg-value">${fmtNum(f.jobs_announced)}</div></div>
      <div><div class="pg-label">Jobs Created</div><div class="pg-value">${fmtNum(f.jobs_created)}</div></div>
      <div><div class="pg-label">Technology</div><div class="pg-value">${f.technology}</div></div>
      <div><div class="pg-label">Announced</div><div class="pg-value">${f.announced_date||'‚Äî'}</div></div>
    </div>
    ${funding?`<div class="popup-funding"><div class="pg-label" style="margin-bottom:0.3rem">Funding Sources</div>${funding}</div>`:''}`).addTo(map);
}

function selectFacility(id){
  document.querySelectorAll('.facility-item').forEach(e=>e.classList.remove('active'));
  const el=document.querySelector(`.facility-item[data-id="${id}"]`);
  if(el)el.classList.add('active');
  const f=allFacilities.find(x=>x.id===id);
  if(f&&map){map.flyTo({center:[f.lng,f.lat],zoom:8,duration:1000});setTimeout(()=>showPopup(f),1100);}
}

async function renderCharts(){
  const isDark=document.documentElement.dataset.theme==='dark';
  const gc=isDark?'rgba(255,255,255,0.06)':'rgba(0,0,0,0.06)';
  const tc=isDark?'#a1a1aa':'#71717a';
  Chart.defaults.color=tc;Chart.defaults.borderColor=gc;Chart.defaults.font.family="'Geist',system-ui,sans-serif";

  // Investment by technology (computed from embedded data)
  const techTotals={};
  allFacilities.forEach(f=>{techTotals[f.technology]=(techTotals[f.technology]||0)+(f.investment_total||0)});
  const techKeys=Object.keys(techTotals).sort((a,b)=>techTotals[b]-techTotals[a]);
  charts.tech=new Chart(document.getElementById('chartTech'),{type:'bar',data:{labels:techKeys,datasets:[{label:'Investment ($B)',data:techKeys.map(k=>techTotals[k]/1e9),backgroundColor:techKeys.map(k=>TECH_COLORS[k]||TECH_COLORS.other),borderRadius:4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{grid:{color:gc},ticks:{callback:v=>'$'+v+'B'}},x:{grid:{display:false}}}}});

  // Investment by state
  const stateTotals={};
  allFacilities.forEach(f=>{stateTotals[f.state]=(stateTotals[f.state]||0)+(f.investment_total||0)});
  const top10=Object.entries(stateTotals).sort((a,b)=>b[1]-a[1]).slice(0,10);
  charts.state=new Chart(document.getElementById('chartState'),{type:'bar',data:{labels:top10.map(d=>d[0]),datasets:[{label:'Investment ($B)',data:top10.map(d=>d[1]/1e9),backgroundColor:'hsl(142 71% 45%)',borderRadius:4}]},options:{indexAxis:'y',responsive:true,plugins:{legend:{display:false}},scales:{x:{grid:{color:gc},ticks:{callback:v=>'$'+v+'B'}},y:{grid:{display:false}}}}});

  // Jobs by technology
  const jobsTech={};
  allFacilities.forEach(f=>{if(!jobsTech[f.technology])jobsTech[f.technology]={a:0,c:0};jobsTech[f.technology].a+=(f.jobs_announced||0);jobsTech[f.technology].c+=(f.jobs_created||0)});
  const jKeys=Object.keys(jobsTech);
  charts.jobs=new Chart(document.getElementById('chartJobs'),{type:'bar',data:{labels:jKeys,datasets:[{label:'Announced',data:jKeys.map(k=>jobsTech[k].a),backgroundColor:'hsl(142 71% 45%)',borderRadius:4},{label:'Created',data:jKeys.map(k=>jobsTech[k].c),backgroundColor:'hsl(217 91% 60%)',borderRadius:4}]},options:{responsive:true,scales:{y:{grid:{color:gc},ticks:{callback:v=>v>=1000?(v/1000)+'K':v}},x:{grid:{display:false}}}}});

  // Funding source breakdown
  const fundTotals={};
  allFacilities.forEach(f=>{(f.funding_sources||[]).forEach(s=>{fundTotals[s.source]=(fundTotals[s.source]||0)+s.amount})});
  const srcLabels={IRA_48C:'IRA 48C',CHIPS:'CHIPS Act',DOE_LPO:'DOE LPO',state:'State',private:'Private'};
  const srcColors={IRA_48C:'#facc15',CHIPS:'#a855f7',DOE_LPO:'#3b82f6',state:'#06b6d4',private:'#22c55e'};
  const fundKeys=Object.keys(fundTotals).sort((a,b)=>fundTotals[b]-fundTotals[a]);
  charts.funding=new Chart(document.getElementById('chartFunding'),{type:'bar',data:{labels:fundKeys.map(k=>srcLabels[k]||k),datasets:[{label:'Amount ($B)',data:fundKeys.map(k=>fundTotals[k]/1e9),backgroundColor:fundKeys.map(k=>srcColors[k]||'#888'),borderRadius:4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{grid:{color:gc},ticks:{callback:v=>'$'+v+'B'}},x:{grid:{display:false}}}}});

  const groups={Federal:0,State:0,Private:0};
  Object.entries(fundTotals).forEach(([k,v])=>{if(['IRA_48C','CHIPS','DOE_LPO'].includes(k))groups.Federal+=v;else if(k==='state')groups.State+=v;else groups.Private+=v});
  charts.fundingPie=new Chart(document.getElementById('chartFundingPie'),{type:'doughnut',data:{labels:Object.keys(groups),datasets:[{data:Object.values(groups).map(v=>v/1e9),backgroundColor:['#a855f7','#06b6d4','#22c55e'],borderWidth:0}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}});

  const byYear={},invByYear={};
  allFacilities.forEach(f=>{if(!f.announced_date)return;const y=f.announced_date.substring(0,4);byYear[y]=(byYear[y]||0)+1;invByYear[y]=(invByYear[y]||0)+(f.investment_total||0)});
  const years=Object.keys(byYear).sort();
  charts.timeline=new Chart(document.getElementById('chartTimeline'),{type:'bar',data:{labels:years,datasets:[{label:'Facilities Announced',data:years.map(y=>byYear[y]||0),backgroundColor:'hsl(142 71% 45%)',borderRadius:4,yAxisID:'y'},{label:'Investment ($B)',data:years.map(y=>(invByYear[y]||0)/1e9),type:'line',borderColor:'#facc15',backgroundColor:'rgba(250,204,21,0.1)',fill:true,tension:0.3,yAxisID:'y1'}]},options:{responsive:true,scales:{y:{grid:{color:gc},title:{display:true,text:'# Facilities'}},y1:{position:'right',grid:{display:false},title:{display:true,text:'Investment ($B)'},ticks:{callback:v=>'$'+v+'B'}},x:{grid:{display:false}}}}});
}

function setupEvents(){
  document.querySelectorAll('#techFilters .chip').forEach(el=>{el.addEventListener('click',()=>{document.querySelectorAll('#techFilters .chip').forEach(c=>c.classList.remove('active'));el.classList.add('active');filters.technology=el.dataset.val;applyFilters()})});
  document.querySelectorAll('#statusFilters .chip').forEach(el=>{el.addEventListener('click',()=>{document.querySelectorAll('#statusFilters .chip').forEach(c=>c.classList.remove('active'));el.classList.add('active');filters.status=el.dataset.val;applyFilters()})});
  document.getElementById('fundingFilter').addEventListener('change',e=>{filters.funding=e.target.value;if(filters.funding){filteredFacilities=filteredFacilities.filter(f=>(f.funding_sources||[]).some(s=>s.source===filters.funding));renderList();renderStats();updateMapMarkers()}else{applyFilters()}});
  document.getElementById('searchInput').addEventListener('input',e=>{filters.q=e.target.value;applyFilters()});
  document.querySelectorAll('.tab').forEach(el=>{el.addEventListener('click',()=>{document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));el.classList.add('active');document.getElementById('tab-'+el.dataset.tab).classList.add('active');if(el.dataset.tab==='map')setTimeout(()=>map?.resize(),100)})});
}

init();
</script>
<script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
