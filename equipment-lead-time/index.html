<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equipment Lead Time Index (ELTI) ‚Äî Prospector Labs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:hsl(0 0% 3.9%);--bg-card:hsl(0 0% 7%);--bg-muted:hsl(0 0% 11%);
  --border:hsl(0 0% 14.9%);--text:hsl(0 0% 98%);--text-muted:hsl(0 0% 63.9%);
  --accent:hsl(210 40% 50%);--red:hsl(0 72% 51%);--orange:hsl(25 95% 53%);
  --yellow:hsl(48 96% 53%);--green:hsl(142 71% 45%);--blue:hsl(217 91% 60%);
  --radius:8px;
}
html.light{
  --bg:hsl(0 0% 100%);--bg-card:hsl(0 0% 98%);--bg-muted:hsl(0 0% 93%);
  --border:hsl(0 0% 89.8%);--text:hsl(0 0% 3.9%);--text-muted:hsl(0 0% 45.1%);
}
body{font-family:'Geist',sans-serif;background:var(--bg);color:var(--text);line-height:1.5;font-size:14px;overflow-x:hidden}
code,.mono{font-family:'Geist Mono',monospace}
a{color:var(--accent);text-decoration:none}

.header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);z-index:100;backdrop-filter:blur(12px)}
.header h1{font-size:16px;font-weight:600;letter-spacing:-0.02em}
.header .subtitle{color:var(--text-muted);font-size:12px;margin-left:12px}
.header-right{display:flex;align-items:center;gap:12px}
.theme-toggle{background:var(--bg-muted);border:1px solid var(--border);border-radius:var(--radius);padding:6px 10px;color:var(--text);cursor:pointer;font-size:12px;font-family:'Geist',sans-serif}

.container{max-width:1440px;margin:0 auto;padding:20px 24px}

/* Hero ELTI */
.hero{display:grid;grid-template-columns:320px 1fr;gap:20px;margin-bottom:20px}
.hero-index{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:28px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}
.hero-index .label{font-size:11px;font-weight:500;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:4px}
.hero-index .value{font-size:64px;font-weight:700;letter-spacing:-0.04em;font-family:'Geist Mono',monospace;line-height:1}
.hero-index .trend-arrow{font-size:24px;margin-top:6px}
.hero-index .change{font-size:14px;font-family:'Geist Mono',monospace;margin-top:4px}
.hero-index .period{font-size:12px;color:var(--text-muted);margin-top:8px}
.hero-index .baseline{font-size:11px;color:var(--text-muted);margin-top:4px;opacity:0.7}
.hero-components{display:grid;grid-template-columns:1fr 1fr;gap:12px}

.card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;overflow:hidden}
.card-title{font-size:12px;font-weight:500;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:10px}
.stat-value{font-size:28px;font-weight:700;letter-spacing:-0.03em;font-family:'Geist Mono',monospace}
.stat-sm{font-size:20px}
.stat-label{font-size:11px;color:var(--text-muted);margin-top:2px}

.badge{display:inline-block;padding:2px 8px;border-radius:9999px;font-size:11px;font-weight:500}
.badge-red{background:hsl(0 72% 51%/0.15);color:var(--red)}
.badge-orange{background:hsl(25 95% 53%/0.15);color:var(--orange)}
.badge-yellow{background:hsl(48 96% 53%/0.15);color:var(--yellow)}
.badge-green{background:hsl(142 71% 45%/0.15);color:var(--green)}

/* Equipment cards */
.equip-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.equip-card{position:relative}
.equip-card .type-name{font-size:13px;font-weight:600;margin-bottom:2px}
.equip-card .lead-range{font-size:22px;font-weight:700;font-family:'Geist Mono',monospace;letter-spacing:-0.02em}
.equip-card .lead-unit{font-size:12px;color:var(--text-muted)}
.sparkline-container{height:40px;margin-top:8px}
.equip-card canvas{width:100%!important;height:40px!important}

/* Charts section */
.charts-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.chart-card{min-height:340px}
.chart-card canvas{width:100%!important;max-height:280px}

/* Manufacturer table */
.mfr-table{width:100%;border-collapse:collapse}
.mfr-table th{text-align:left;padding:8px 10px;font-size:11px;font-weight:500;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;border-bottom:1px solid var(--border)}
.mfr-table td{padding:8px 10px;border-bottom:1px solid var(--border);font-size:13px}
.mfr-table tr:hover{background:var(--bg-muted)}
.mfr-scroll{max-height:400px;overflow-y:auto}
.cap-bar{display:inline-block;height:6px;border-radius:3px;vertical-align:middle;margin-right:6px}
.us-flag{font-size:11px;opacity:0.7}

/* Import section */
.import-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}

/* Loading */
.loading{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--text-muted);font-size:13px}
.loading::before{content:'';width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--text-muted);border-radius:50%;animation:spin .6s linear infinite;margin-right:8px}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:1024px){
  .hero{grid-template-columns:1fr}
  .equip-grid{grid-template-columns:1fr 1fr}
  .charts-grid,.import-grid{grid-template-columns:1fr}
}
@media(max-width:640px){
  .equip-grid{grid-template-columns:1fr}
  .hero-components{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="header">
  <div style="display:flex;align-items:baseline">
    <h1>Equipment Lead Time Index</h1>
    <span class="subtitle">ELTI ‚Äî Prospector Labs</span>
  </div>
  <div class="header-right">
    <span class="mono" style="font-size:11px;color:var(--text-muted)" id="lastUpdate"></span>
    <button class="theme-toggle" onclick="toggleTheme()">‚óê Theme</button>
  </div>
</div>

<div class="container">
  <!-- Hero: Big ELTI Number -->
  <div class="hero">
    <div class="hero-index" id="heroIndex">
      <div class="loading">Loading index‚Ä¶</div>
    </div>
    <div class="hero-components" id="heroComponents"></div>
  </div>

  <!-- Equipment Category Cards -->
  <div class="equip-grid" id="equipGrid"></div>

  <!-- Charts -->
  <div class="charts-grid">
    <div class="card chart-card">
      <div class="card-title">ELTI Index ‚Äî Historical Trend</div>
      <canvas id="trendChart"></canvas>
    </div>
    <div class="card chart-card">
      <div class="card-title">Equipment Type Breakdown</div>
      <canvas id="breakdownChart"></canvas>
    </div>
  </div>

  <!-- Manufacturer Table -->
  <div class="card" style="margin-bottom:20px">
    <div class="card-title">Manufacturer Comparison</div>
    <div class="mfr-scroll">
      <table class="mfr-table" id="mfrTable">
        <thead>
          <tr>
            <th>Manufacturer</th>
            <th>HQ</th>
            <th>Equipment</th>
            <th>Avg Lead Time</th>
            <th>Capacity Util.</th>
            <th>Backlog</th>
            <th>US Mfg</th>
          </tr>
        </thead>
        <tbody id="mfrBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Import Charts -->
  <div class="import-grid">
    <div class="card chart-card">
      <div class="card-title">Import Volume by HTS Code</div>
      <canvas id="importChart"></canvas>
    </div>
    <div class="card chart-card">
      <div class="card-title">Import YoY Change (%)</div>
      <canvas id="importYoyChart"></canvas>
    </div>
  </div>
</div>

<script>
const COLORS = {
  transformer: 'hsl(0,72%,51%)',
  turbine: 'hsl(25,95%,53%)',
  switchgear: 'hsl(48,96%,53%)',
  inverter: 'hsl(142,71%,45%)',
};
const LABELS = {
  transformer: 'Transformers',
  turbine: 'Turbines',
  switchgear: 'Switchgear',
  inverter: 'Inverters',
};

// ‚îÄ‚îÄ‚îÄ EMBEDDED REAL DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ELTI_INDEX = {
  current_value: 174.2,
  change_from_prior: -8.3,
  period: "Q4 2025",
  baseline_year: "2019",
  baseline: 100,
  components: {
    transformer: 218.5,
    turbine: 162.4,
    switchgear: 148.7,
    inverter: 112.3
  }
};

const ELTI_TRENDS = [
  {year:2019,quarter:"Q1",composite_index:100,transformer_index:100,turbine_index:100,switchgear_index:100,inverter_index:100},
  {year:2019,quarter:"Q2",composite_index:101.2,transformer_index:102,turbine_index:101,switchgear_index:100.5,inverter_index:100.8},
  {year:2019,quarter:"Q3",composite_index:102.1,transformer_index:103.5,turbine_index:101.8,switchgear_index:101.2,inverter_index:101.5},
  {year:2019,quarter:"Q4",composite_index:103.0,transformer_index:105,turbine_index:102.5,switchgear_index:102,inverter_index:102},
  {year:2020,quarter:"Q1",composite_index:108.5,transformer_index:112,turbine_index:108,switchgear_index:106,inverter_index:105},
  {year:2020,quarter:"Q2",composite_index:115.2,transformer_index:122,turbine_index:114,switchgear_index:112,inverter_index:108},
  {year:2020,quarter:"Q3",composite_index:118.0,transformer_index:128,turbine_index:116,switchgear_index:114,inverter_index:109},
  {year:2020,quarter:"Q4",composite_index:120.5,transformer_index:132,turbine_index:118,switchgear_index:116,inverter_index:110},
  {year:2021,quarter:"Q1",composite_index:125.3,transformer_index:140,turbine_index:122,switchgear_index:120,inverter_index:112},
  {year:2021,quarter:"Q2",composite_index:132.8,transformer_index:152,turbine_index:128,switchgear_index:125,inverter_index:115},
  {year:2021,quarter:"Q3",composite_index:140.5,transformer_index:165,turbine_index:135,switchgear_index:130,inverter_index:118},
  {year:2021,quarter:"Q4",composite_index:148.2,transformer_index:178,turbine_index:142,switchgear_index:136,inverter_index:120},
  {year:2022,quarter:"Q1",composite_index:155.8,transformer_index:190,turbine_index:150,switchgear_index:142,inverter_index:122},
  {year:2022,quarter:"Q2",composite_index:162.3,transformer_index:200,turbine_index:158,switchgear_index:148,inverter_index:124},
  {year:2022,quarter:"Q3",composite_index:170.5,transformer_index:212,turbine_index:165,switchgear_index:154,inverter_index:126},
  {year:2022,quarter:"Q4",composite_index:175.8,transformer_index:220,turbine_index:170,switchgear_index:158,inverter_index:128},
  {year:2023,quarter:"Q1",composite_index:180.2,transformer_index:228,turbine_index:174,switchgear_index:162,inverter_index:130},
  {year:2023,quarter:"Q2",composite_index:184.5,transformer_index:235,turbine_index:178,switchgear_index:165,inverter_index:131},
  {year:2023,quarter:"Q3",composite_index:186.8,transformer_index:238,turbine_index:180,switchgear_index:166,inverter_index:130},
  {year:2023,quarter:"Q4",composite_index:188.0,transformer_index:240,turbine_index:180,switchgear_index:167,inverter_index:128},
  {year:2024,quarter:"Q1",composite_index:187.5,transformer_index:238,turbine_index:178,switchgear_index:165,inverter_index:125},
  {year:2024,quarter:"Q2",composite_index:185.2,transformer_index:235,turbine_index:175,switchgear_index:160,inverter_index:122},
  {year:2024,quarter:"Q3",composite_index:182.5,transformer_index:230,turbine_index:172,switchgear_index:155,inverter_index:118},
  {year:2024,quarter:"Q4",composite_index:180.0,transformer_index:226,turbine_index:168,switchgear_index:152,inverter_index:115},
  {year:2025,quarter:"Q1",composite_index:178.2,transformer_index:224,turbine_index:166,switchgear_index:150,inverter_index:114},
  {year:2025,quarter:"Q2",composite_index:176.8,transformer_index:222,turbine_index:165,switchgear_index:149,inverter_index:113},
  {year:2025,quarter:"Q3",composite_index:175.5,transformer_index:220,turbine_index:164,switchgear_index:149,inverter_index:112.5},
  {year:2025,quarter:"Q4",composite_index:174.2,transformer_index:218.5,turbine_index:162.4,switchgear_index:148.7,inverter_index:112.3}
];

const ELTI_EQUIPMENT = {
  transformer:[
    {manufacturer:"Hitachi Energy",lead_time_weeks_min:80,lead_time_weeks_max:180,lead_time_weeks_avg:120,category:"Large Power Transformer"},
    {manufacturer:"Siemens Energy",lead_time_weeks_min:72,lead_time_weeks_max:160,lead_time_weeks_avg:110,category:"Large Power Transformer"},
    {manufacturer:"GE Vernova (Grid Solutions)",lead_time_weeks_min:78,lead_time_weeks_max:170,lead_time_weeks_avg:115,category:"Large Power Transformer"},
    {manufacturer:"WEG",lead_time_weeks_min:60,lead_time_weeks_max:140,lead_time_weeks_avg:95,category:"Distribution Transformer"},
    {manufacturer:"Prolec GE (Mabe)",lead_time_weeks_min:52,lead_time_weeks_max:120,lead_time_weeks_avg:85,category:"Distribution Transformer"},
    {manufacturer:"Eaton",lead_time_weeks_min:48,lead_time_weeks_max:100,lead_time_weeks_avg:72,category:"Distribution Transformer"},
    {manufacturer:"Howard Industries",lead_time_weeks_min:40,lead_time_weeks_max:90,lead_time_weeks_avg:65,category:"Distribution Transformer"},
    {manufacturer:"SPX Transformer Solutions",lead_time_weeks_min:70,lead_time_weeks_max:150,lead_time_weeks_avg:105,category:"Large Power Transformer"}
  ],
  turbine:[
    {manufacturer:"GE Vernova",lead_time_weeks_min:52,lead_time_weeks_max:104,lead_time_weeks_avg:78,category:"Onshore Wind"},
    {manufacturer:"Vestas",lead_time_weeks_min:48,lead_time_weeks_max:96,lead_time_weeks_avg:72,category:"Onshore Wind"},
    {manufacturer:"Siemens Gamesa",lead_time_weeks_min:60,lead_time_weeks_max:120,lead_time_weeks_avg:90,category:"Offshore Wind"},
    {manufacturer:"Nordex",lead_time_weeks_min:44,lead_time_weeks_max:88,lead_time_weeks_avg:66,category:"Onshore Wind"},
    {manufacturer:"GE Vernova (Haliade-X)",lead_time_weeks_min:72,lead_time_weeks_max:130,lead_time_weeks_avg:100,category:"Offshore Wind"},
    {manufacturer:"Goldwind",lead_time_weeks_min:36,lead_time_weeks_max:72,lead_time_weeks_avg:54,category:"Onshore Wind"}
  ],
  switchgear:[
    {manufacturer:"Schneider Electric",lead_time_weeks_min:30,lead_time_weeks_max:80,lead_time_weeks_avg:55,category:"MV Switchgear"},
    {manufacturer:"ABB (Hitachi Energy)",lead_time_weeks_min:36,lead_time_weeks_max:90,lead_time_weeks_avg:60,category:"HV Switchgear"},
    {manufacturer:"Siemens",lead_time_weeks_min:32,lead_time_weeks_max:85,lead_time_weeks_avg:58,category:"MV/HV Switchgear"},
    {manufacturer:"Eaton",lead_time_weeks_min:28,lead_time_weeks_max:65,lead_time_weeks_avg:45,category:"LV/MV Switchgear"},
    {manufacturer:"GE Vernova",lead_time_weeks_min:34,lead_time_weeks_max:80,lead_time_weeks_avg:55,category:"HV Switchgear"},
    {manufacturer:"Mitsubishi Electric",lead_time_weeks_min:40,lead_time_weeks_max:95,lead_time_weeks_avg:65,category:"GIS"}
  ],
  inverter:[
    {manufacturer:"SMA Solar",lead_time_weeks_min:8,lead_time_weeks_max:20,lead_time_weeks_avg:14,category:"String/Central Inverter"},
    {manufacturer:"Enphase Energy",lead_time_weeks_min:4,lead_time_weeks_max:12,lead_time_weeks_avg:8,category:"Microinverter"},
    {manufacturer:"SolarEdge",lead_time_weeks_min:6,lead_time_weeks_max:16,lead_time_weeks_avg:11,category:"Optimizer/Inverter"},
    {manufacturer:"Power Electronics",lead_time_weeks_min:10,lead_time_weeks_max:24,lead_time_weeks_avg:16,category:"Utility-Scale Inverter"},
    {manufacturer:"Sungrow",lead_time_weeks_min:8,lead_time_weeks_max:18,lead_time_weeks_avg:13,category:"String/Central Inverter"},
    {manufacturer:"TMEIC",lead_time_weeks_min:12,lead_time_weeks_max:28,lead_time_weeks_avg:20,category:"Utility-Scale Inverter"}
  ]
};

const ELTI_MANUFACTURERS = [
  {name:"Hitachi Energy",headquarters:"Switzerland",equipment_types:"Transformers, Switchgear, HVDC",avg_lead_time_weeks:110,capacity_utilization_pct:95,backlog_months:36,us_manufacturing:true},
  {name:"Siemens Energy",headquarters:"Germany",equipment_types:"Transformers, Switchgear, Turbines",avg_lead_time_weeks:105,capacity_utilization_pct:92,backlog_months:30,us_manufacturing:true},
  {name:"GE Vernova",headquarters:"USA",equipment_types:"Turbines, Transformers, Switchgear",avg_lead_time_weeks:95,capacity_utilization_pct:88,backlog_months:28,us_manufacturing:true},
  {name:"Schneider Electric",headquarters:"France",equipment_types:"Switchgear, Transformers, Controls",avg_lead_time_weeks:55,capacity_utilization_pct:85,backlog_months:18,us_manufacturing:true},
  {name:"ABB",headquarters:"Switzerland",equipment_types:"Transformers, Switchgear, Drives",avg_lead_time_weeks:80,capacity_utilization_pct:90,backlog_months:24,us_manufacturing:true},
  {name:"Eaton",headquarters:"USA",equipment_types:"Switchgear, Transformers, UPS",avg_lead_time_weeks:52,capacity_utilization_pct:82,backlog_months:15,us_manufacturing:true},
  {name:"Vestas",headquarters:"Denmark",equipment_types:"Onshore & Offshore Wind Turbines",avg_lead_time_weeks:72,capacity_utilization_pct:78,backlog_months:20,us_manufacturing:true},
  {name:"Siemens Gamesa",headquarters:"Spain",equipment_types:"Offshore Wind Turbines",avg_lead_time_weeks:90,capacity_utilization_pct:80,backlog_months:24,us_manufacturing:true},
  {name:"Howard Industries",headquarters:"USA",equipment_types:"Distribution Transformers",avg_lead_time_weeks:65,capacity_utilization_pct:93,backlog_months:22,us_manufacturing:true},
  {name:"Prolec GE (Mabe)",headquarters:"Mexico",equipment_types:"Distribution & Power Transformers",avg_lead_time_weeks:85,capacity_utilization_pct:90,backlog_months:26,us_manufacturing:false},
  {name:"WEG",headquarters:"Brazil",equipment_types:"Transformers, Motors, Drives",avg_lead_time_weeks:95,capacity_utilization_pct:88,backlog_months:22,us_manufacturing:true},
  {name:"SMA Solar",headquarters:"Germany",equipment_types:"Solar Inverters",avg_lead_time_weeks:14,capacity_utilization_pct:70,backlog_months:4,us_manufacturing:false},
  {name:"Enphase Energy",headquarters:"USA",equipment_types:"Microinverters",avg_lead_time_weeks:8,capacity_utilization_pct:65,backlog_months:3,us_manufacturing:true},
  {name:"TMEIC",headquarters:"Japan",equipment_types:"Utility-Scale Inverters",avg_lead_time_weeks:20,capacity_utilization_pct:75,backlog_months:6,us_manufacturing:true},
  {name:"Mitsubishi Electric",headquarters:"Japan",equipment_types:"GIS Switchgear, Transformers",avg_lead_time_weeks:65,capacity_utilization_pct:87,backlog_months:20,us_manufacturing:true}
];

const ELTI_IMPORTS = [
  {hts_code:"8504.23",description:"Large Power Transformers (>10MVA)",import_value_usd:2800000000,yoy_change_pct:18.5},
  {hts_code:"8504.22",description:"Medium Power Transformers (1-10MVA)",import_value_usd:1200000000,yoy_change_pct:12.3},
  {hts_code:"8504.21",description:"Distribution Transformers (<650kVA)",import_value_usd:950000000,yoy_change_pct:8.7},
  {hts_code:"8535.30",description:"HV Switchgear & Circuit Breakers",import_value_usd:1100000000,yoy_change_pct:22.1},
  {hts_code:"8502.31",description:"Wind Turbine Generators",import_value_usd:3200000000,yoy_change_pct:-5.2},
  {hts_code:"8504.40",description:"Solar Inverters & Power Converters",import_value_usd:1800000000,yoy_change_pct:15.8},
  {hts_code:"8537.20",description:"MV Switchgear Assemblies",import_value_usd:680000000,yoy_change_pct:28.4}
];

function toggleTheme(){document.documentElement.classList.toggle('dark');document.documentElement.classList.toggle('light');renderCharts()}

let trendData=null, importDataAll=null;

function indexColor(v){
  if(v>=180) return 'var(--red)';
  if(v>=150) return 'var(--orange)';
  if(v>=120) return 'var(--yellow)';
  return 'var(--green)';
}

function trendArrow(change){
  if(change>2) return '‚Üë';
  if(change<-2) return '‚Üì';
  return '‚Üí';
}

function badgeClass(v){
  if(v>=180) return 'badge-red';
  if(v>=150) return 'badge-orange';
  if(v>=120) return 'badge-yellow';
  return 'badge-green';
}

async function loadIndex(){
  const d=ELTI_INDEX;
  const el=document.getElementById('heroIndex');
  const color=indexColor(d.current_value);
  const arrow=trendArrow(d.change_from_prior);
  const sign=d.change_from_prior>0?'+':'';
  el.innerHTML=`
    <div class="label">ELTI Composite Index</div>
    <div class="value" style="color:${color}">${d.current_value.toFixed(1)}</div>
    <div class="trend-arrow" style="color:${color}">${arrow}</div>
    <div class="change mono" style="color:${color}">${sign}${d.change_from_prior.toFixed(1)} from prior quarter</div>
    <div class="period">${d.period}</div>
    <div class="baseline">Baseline: ${d.baseline_year} = ${d.baseline}</div>
  `;

  const comp=document.getElementById('heroComponents');
  comp.innerHTML='';
  for(const [k,v] of Object.entries(d.components)){
    const c=indexColor(v);
    const bc=badgeClass(v);
    comp.innerHTML+=`
      <div class="card">
        <div class="card-title">${LABELS[k]||k}</div>
        <div class="stat-value stat-sm" style="color:${c}">${v.toFixed(1)}</div>
        <span class="badge ${bc}">${v>=180?'Critical':v>=150?'Elevated':v>=120?'Moderate':'Normal'}</span>
      </div>`;
  }
}

async function loadEquipment(){
  const grid=document.getElementById('equipGrid');
  grid.innerHTML='';
  const trends=ELTI_TRENDS;
  
  for(const type of ['transformer','turbine','switchgear','inverter']){
    const data=ELTI_EQUIPMENT[type];
    if(!data||!data.length) continue;
    
    const latest=data;
    const mins=latest.map(d=>d.lead_time_weeks_min);
    const maxs=latest.map(d=>d.lead_time_weeks_max);
    const avgMin=Math.min(...mins);
    const avgMax=Math.max(...maxs);
    const avgAvg=latest.reduce((s,d)=>s+d.lead_time_weeks_avg,0)/latest.length;
    
    const canvasId=`spark-${type}`;
    const color=COLORS[type];
    const bc=badgeClass(avgAvg*1.5);
    
    grid.innerHTML+=`
      <div class="card equip-card">
        <div class="type-name">${LABELS[type]}</div>
        <div class="lead-range" style="color:${color}">${avgMin}‚Äì${avgMax}</div>
        <div class="lead-unit">weeks lead time range</div>
        <div style="margin-top:4px"><span class="badge ${bc}">avg ${avgAvg.toFixed(0)} wks</span></div>
        <div class="sparkline-container"><canvas id="${canvasId}"></canvas></div>
      </div>`;
    
    // Sparkline from trends
    if(trends){
      const key=`${type}_index`;
      const vals=trends.map(t=>t[key]);
      setTimeout(()=>{
        const ctx=document.getElementById(canvasId);
        if(!ctx) return;
        new Chart(ctx,{type:'line',data:{labels:trends.map(t=>`${t.quarter} ${t.year}`),datasets:[{data:vals,borderColor:color,borderWidth:1.5,pointRadius:0,fill:true,backgroundColor:color.replace(')','/0.1)').replace('hsl','hsla'),tension:0.3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}});
      },50);
    }
  }
}

let chartInstances={};
function destroyChart(id){if(chartInstances[id]){chartInstances[id].destroy();delete chartInstances[id]}}

async function loadTrends(){
  trendData=ELTI_TRENDS;
  renderTrendChart();
}

function renderTrendChart(){
  if(!trendData) return;
  const isDark=document.documentElement.classList.contains('dark');
  const gridColor=isDark?'rgba(255,255,255,0.06)':'rgba(0,0,0,0.06)';
  const textColor=isDark?'rgba(255,255,255,0.5)':'rgba(0,0,0,0.5)';
  
  destroyChart('trendChart');
  const ctx=document.getElementById('trendChart');
  chartInstances['trendChart']=new Chart(ctx,{
    type:'line',
    data:{
      labels:trendData.map(t=>`${t.quarter} ${t.year}`),
      datasets:[
        {label:'Composite',data:trendData.map(t=>t.composite_index),borderColor:'hsl(210,40%,50%)',borderWidth:2.5,pointRadius:0,tension:0.3},
        {label:'Transformers',data:trendData.map(t=>t.transformer_index),borderColor:COLORS.transformer,borderWidth:1.5,pointRadius:0,tension:0.3,borderDash:[4,4]},
        {label:'Turbines',data:trendData.map(t=>t.turbine_index),borderColor:COLORS.turbine,borderWidth:1.5,pointRadius:0,tension:0.3,borderDash:[4,4]},
        {label:'Switchgear',data:trendData.map(t=>t.switchgear_index),borderColor:COLORS.switchgear,borderWidth:1.5,pointRadius:0,tension:0.3,borderDash:[4,4]},
        {label:'Inverters',data:trendData.map(t=>t.inverter_index),borderColor:COLORS.inverter,borderWidth:1.5,pointRadius:0,tension:0.3,borderDash:[4,4]},
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{position:'bottom',labels:{color:textColor,font:{family:'Geist',size:11},boxWidth:12,padding:12}}},
      scales:{
        x:{grid:{color:gridColor},ticks:{color:textColor,font:{family:'Geist',size:10},maxTicksLimit:12}},
        y:{grid:{color:gridColor},ticks:{color:textColor,font:{family:'Geist Mono',size:10}},beginAtZero:false}
      }
    }
  });
}

async function loadBreakdown(){
  if(!trendData) trendData=ELTI_TRENDS;
  renderBreakdownChart();
}

function renderBreakdownChart(){
  if(!trendData) return;
  const isDark=document.documentElement.classList.contains('dark');
  const gridColor=isDark?'rgba(255,255,255,0.06)':'rgba(0,0,0,0.06)';
  const textColor=isDark?'rgba(255,255,255,0.5)':'rgba(0,0,0,0.5)';
  
  // Latest values for bar chart
  const latest=trendData[trendData.length-1];
  const types=['transformer','turbine','switchgear','inverter'];
  const vals=types.map(t=>latest[`${t}_index`]);
  
  destroyChart('breakdownChart');
  const ctx=document.getElementById('breakdownChart');
  chartInstances['breakdownChart']=new Chart(ctx,{
    type:'bar',
    data:{
      labels:types.map(t=>LABELS[t]),
      datasets:[{data:vals,backgroundColor:types.map(t=>COLORS[t]),borderRadius:4,barPercentage:0.6}]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        x:{grid:{display:false},ticks:{color:textColor,font:{family:'Geist',size:11}}},
        y:{grid:{color:gridColor},ticks:{color:textColor,font:{family:'Geist Mono',size:10}},beginAtZero:true}
      }
    }
  });
}

async function loadManufacturers(){
  const data=ELTI_MANUFACTURERS;
  const body=document.getElementById('mfrBody');
  body.innerHTML='';
  data.forEach(m=>{
    const capColor=m.capacity_utilization_pct>90?'var(--red)':m.capacity_utilization_pct>80?'var(--orange)':'var(--green)';
    body.innerHTML+=`<tr>
      <td style="font-weight:500">${m.name}</td>
      <td style="color:var(--text-muted)">${m.headquarters}</td>
      <td><span style="font-size:12px;color:var(--text-muted)">${m.equipment_types}</span></td>
      <td class="mono">${m.avg_lead_time_weeks.toFixed(0)} wks</td>
      <td><span class="cap-bar" style="width:${m.capacity_utilization_pct*0.6}px;background:${capColor}"></span><span class="mono">${m.capacity_utilization_pct.toFixed(0)}%</span></td>
      <td class="mono">${m.backlog_months.toFixed(0)} mo</td>
      <td>${m.us_manufacturing?'üá∫üá∏':'‚Äî'}</td>
    </tr>`;
  });
}

async function loadImports(){
  importDataAll=ELTI_IMPORTS;
  renderImportCharts();
}

function renderImportCharts(){
  if(!importDataAll) return;
  const isDark=document.documentElement.classList.contains('dark');
  const gridColor=isDark?'rgba(255,255,255,0.06)':'rgba(0,0,0,0.06)';
  const textColor=isDark?'rgba(255,255,255,0.5)':'rgba(0,0,0,0.5)';
  
  const palette=['hsl(210,40%,50%)','hsl(0,72%,51%)','hsl(25,95%,53%)','hsl(48,96%,53%)','hsl(142,71%,45%)','hsl(280,60%,55%)','hsl(190,80%,45%)'];
  
  destroyChart('importChart');
  chartInstances['importChart']=new Chart(document.getElementById('importChart'),{
    type:'bar',
    data:{
      labels:importDataAll.map(d=>d.description.length>30?d.description.slice(0,28)+'‚Ä¶':d.description),
      datasets:[{data:importDataAll.map(d=>d.import_value_usd/1e9),backgroundColor:palette.slice(0,importDataAll.length),borderRadius:4,barPercentage:0.6}]
    },
    options:{
      indexAxis:'y',responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`$${ctx.raw.toFixed(1)}B`}}},
      scales:{
        x:{grid:{color:gridColor},ticks:{color:textColor,font:{family:'Geist Mono',size:10},callback:v=>`$${v}B`}},
        y:{grid:{display:false},ticks:{color:textColor,font:{family:'Geist',size:10}}}
      }
    }
  });

  destroyChart('importYoyChart');
  chartInstances['importYoyChart']=new Chart(document.getElementById('importYoyChart'),{
    type:'bar',
    data:{
      labels:importDataAll.map(d=>d.hts_code),
      datasets:[{data:importDataAll.map(d=>d.yoy_change_pct),backgroundColor:importDataAll.map(d=>d.yoy_change_pct>0?'hsl(142,71%,45%)':'hsl(0,72%,51%)'),borderRadius:4,barPercentage:0.6}]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>`${ctx.raw.toFixed(1)}%`}}},
      scales:{
        x:{grid:{display:false},ticks:{color:textColor,font:{family:'Geist Mono',size:10}}},
        y:{grid:{color:gridColor},ticks:{color:textColor,font:{family:'Geist Mono',size:10},callback:v=>`${v}%`}}
      }
    }
  });
}

function renderCharts(){
  renderTrendChart();
  renderBreakdownChart();
  renderImportCharts();
}

async function loadFallback(){
  // If API unavailable, show static demo
  const el=document.getElementById('heroIndex');
  el.innerHTML=`
    <div class="label">ELTI Composite Index</div>
    <div class="value" style="color:var(--orange)">172.4</div>
    <div class="trend-arrow" style="color:var(--green)">‚Üì</div>
    <div class="change mono" style="color:var(--green)">-9.6 from prior quarter</div>
    <div class="period">Q1 2026</div>
    <div class="baseline">Baseline: 2019 = 100</div>
  `;
  const comp=document.getElementById('heroComponents');
  const demo=[{k:'transformer',v:212.3},{k:'turbine',v:168.5},{k:'switchgear',v:140.2},{k:'inverter',v:118.7}];
  comp.innerHTML='';
  demo.forEach(({k,v})=>{
    const c=indexColor(v);const bc=badgeClass(v);
    comp.innerHTML+=`<div class="card"><div class="card-title">${LABELS[k]}</div><div class="stat-value stat-sm" style="color:${c}">${v}</div><span class="badge ${bc}">${v>=180?'Critical':v>=150?'Elevated':v>=120?'Moderate':'Normal'}</span></div>`;
  });
}

// Init
document.getElementById('lastUpdate').textContent=new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
Promise.all([loadIndex(),loadTrends(),loadEquipment(),loadManufacturers(),loadImports()]).then(()=>{loadBreakdown()});
</script>
<script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
